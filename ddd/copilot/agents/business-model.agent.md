# 業務模組選擇 Agent

> 依據系統架構選擇適當的業務模組

---

## 🎯 Agent 職責

根據功能需求，協助開發者：

1. 選擇適當的業務模組
2. 確定功能是否為新模組或現有模組擴展
3. 判斷功能的歸屬關係
4. 建議實作方式

---

## 📊 六大核心業務模組

```
                    ┌─────────────────┐
                    │    📋 任務系統   │
                    │   (主核心模組)   │
                    └────────┬────────┘
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
         ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   📝 施工日誌    │ │   ✅ 品質驗收    │ │   🐛 問題追蹤    │
│   (關聯任務)     │ │   (驗收任務)     │ │   (任務問題)     │
└─────────────────┘ └─────────────────┘ └─────────────────┘
         │                   │                   │
         └───────────────────┼───────────────────┘
                             │
         ┌───────────────────┼───────────────────┐
         ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   📁 檔案管理    │ │   📊 儀表板      │ │   🔔 通知系統    │
│   (附件存儲)     │ │   (數據聚合)     │ │   (事件通知)     │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

---

## 🔍 模組選擇決策樹

### 問題 1：功能核心目的是什麼？

```
□ 管理施工工作項目與進度
  └── → 任務系統 (Tasks)

□ 記錄每日施工狀況
  └── → 施工日誌 (Diaries)

□ 檢查與驗收品質
  └── → 品質驗收 (Quality Acceptance)

□ 追蹤問題與缺陷
  └── → 問題追蹤 (Issues)

□ 管理文件與圖檔
  └── → 檔案管理 (Files)

□ 顯示統計與報表
  └── → 儀表板 (Dashboard)

□ 推送訊息與提醒
  └── → 通知系統 (Notifications)
```

### 問題 2：是否依附於現有模組？

```
功能是否需要「任務」作為前提？
  ├── 是：評論、附件、進度 → 任務系統子功能
  └── 否：獨立功能

功能是否需要「日誌」作為前提？
  ├── 是：日誌附件、簽核 → 日誌系統子功能
  └── 否：獨立功能

功能是否為數據聚合？
  ├── 是 → 儀表板
  └── 否：原始功能模組
```

---

## 📋 模組職責對照表

### 任務系統 (Tasks)

| 功能 | 包含 | 不包含 |
|------|------|--------|
| 任務 CRUD | ✅ | |
| 子任務管理 | ✅ | |
| 任務狀態流轉 | ✅ | |
| 任務指派 | ✅ | |
| 任務評論 | ✅ | |
| 任務附件 | ✅ | |
| 任務進度追蹤 | ✅ | |
| 日誌記錄 | | ❌ (屬於日誌系統) |
| 品質檢查 | | ❌ (屬於品質驗收) |

### 施工日誌 (Diaries)

| 功能 | 包含 | 不包含 |
|------|------|--------|
| 日誌 CRUD | ✅ | |
| 日誌模板 | ✅ | |
| 天氣記錄 | ✅ | |
| 工時記錄 | ✅ | |
| 日誌簽核 | ✅ | |
| 日誌附件 | ✅ | |
| 任務進度 | | ❌ (屬於任務系統) |

### 品質驗收 (Quality Acceptance)

| 功能 | 包含 | 不包含 |
|------|------|--------|
| 檢查清單管理 | ✅ | |
| 檢查項目勾選 | ✅ | |
| 驗收記錄 | ✅ | |
| 串驗收流程 | ✅ | |
| 驗收照片 | ✅ | |
| 任務狀態變更 | | ❌ (觸發任務系統) |

### 問題追蹤 (Issues)

| 功能 | 包含 | 不包含 |
|------|------|--------|
| 問題回報 | ✅ | |
| 問題指派 | ✅ | |
| 問題處理記錄 | ✅ | |
| 問題關閉 | ✅ | |
| 任務建立 | | ❌ (觸發任務系統) |

---

## 💡 使用方式

### Prompt 範例

```
@agent 業務模組選擇

我需要實現「施工人員可以在任務完成後上傳完工照片」功能：
- 照片需要關聯到特定任務
- 支援多張照片上傳
- 照片可以加上說明文字

這個功能應該歸屬哪個業務模組？
```

### 輸出範例

```markdown
## 模組選擇結果

### 歸屬模組：任務系統 (Tasks)

### 判斷依據

1. **核心目的**：上傳的照片是「任務完工證明」
2. **依附關係**：功能需要「任務」作為前提
3. **資料關聯**：照片關聯到 task_id

### 實作建議

這是任務系統的「附件功能」擴展：

```
src/app/features/blueprint/
├── data-access/
│   └── repositories/
│       └── task-attachment.repository.ts  ← 擴展
├── domain/
│   └── enums/
│       └── attachment-type.enum.ts        ← 新增 COMPLETION_PHOTO 類型
└── ui/
    └── task/
        └── task-detail/
            └── task-attachments/          ← 新增區塊
```

### 資料表設計

使用現有 `task_attachments` 表，增加 `attachment_type` 欄位：

```sql
ALTER TABLE task_attachments
ADD COLUMN attachment_type VARCHAR(50) DEFAULT 'general';

-- 類型：general, completion_photo, reference_doc
```

### 與其他模組的關係

```
任務系統
  │
  ├── 完工照片 (task_attachments.type = 'completion_photo')
  │     │
  │     └── 觸發 → 任務狀態可變更為「待審核」
  │
  └── 品質驗收
        │
        └── 審核完工照片 → 確認驗收
```
```

---

## 📚 參考資源

- [系統架構設計圖](../../../docs/architecture/system-architecture.md)
- [PRD 功能需求](../../../docs/prd/construction-site-management.md)
- [領域名詞對照](../domain-glossary.md)

---

**最後更新**: 2025-11-27
