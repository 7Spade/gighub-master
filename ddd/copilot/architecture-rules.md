# ä¸‰å±¤æ¶æ§‹æ±ºç­–è¦å‰‡

> Foundation / Container / Business æ¶æ§‹å±¤ç´šçš„æ±ºç­–æŒ‡å¼•

---

## ğŸ—ï¸ æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åŸºç¤å±¤ (Foundation Layer)                         â”‚
â”‚                                                                          â”‚
â”‚   å•ï¼šæ¶‰åŠç”¨æˆ¶èº«ä»½ã€çµ„ç¹”ã€Botã€èªè­‰å—ï¼Ÿ                                    â”‚
â”‚   â”œâ”€â”€ æ˜¯ â†’ åœ¨åŸºç¤å±¤è™•ç†                                                   â”‚
â”‚   â”‚   â”œâ”€â”€ å¸³æˆ¶ CRUD â†’ accounts è¡¨                                        â”‚
â”‚   â”‚   â”œâ”€â”€ çµ„ç¹”æˆå“¡ â†’ organization_members è¡¨                             â”‚
â”‚   â”‚   â”œâ”€â”€ åœ˜éšŠç®¡ç† â†’ teams, team_members è¡¨                              â”‚
â”‚   â”‚   â””â”€â”€ Bot ç®¡ç† â†’ accounts (type=BOT) + team_bots è¡¨                  â”‚
â”‚   â””â”€â”€ å¦ â†’ ç¹¼çºŒå¾€ä¸‹å±¤åˆ¤æ–·                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¹å™¨å±¤ (Container Layer)                          â”‚
â”‚                                                                          â”‚
â”‚   å•ï¼šæ¶‰åŠè—åœ–ã€å·¥ä½œå€ã€åˆ†æ”¯ã€æ¬Šé™å—ï¼Ÿ                                     â”‚
â”‚   â”œâ”€â”€ æ˜¯ â†’ åœ¨å®¹å™¨å±¤è™•ç†                                                   â”‚
â”‚   â”‚   â”œâ”€â”€ è—åœ– CRUD â†’ blueprints è¡¨                                      â”‚
â”‚   â”‚   â”œâ”€â”€ å·¥ä½œå€ç®¡ç† â†’ workspaces è¡¨                                     â”‚
â”‚   â”‚   â”œâ”€â”€ Git-like åˆ†æ”¯ â†’ blueprint_branches è¡¨                          â”‚
â”‚   â”‚   â”œâ”€â”€ PR ç®¡ç† â†’ blueprint_pull_requests è¡¨                           â”‚
â”‚   â”‚   â””â”€â”€ è—åœ–æ¬Šé™ â†’ blueprint_members, blueprint_roles è¡¨                â”‚
â”‚   â””â”€â”€ å¦ â†’ åœ¨æ¥­å‹™å±¤è™•ç†                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¥­å‹™å±¤ (Business Layer)                           â”‚
â”‚                                                                          â”‚
â”‚   å•ï¼šå±¬æ–¼å“ªå€‹æ¥­å‹™æ¨¡çµ„ï¼Ÿ                                                  â”‚
â”‚   â”œâ”€â”€ ä»»å‹™ç®¡ç† â†’ tasks, task_attachments, task_comments è¡¨               â”‚
â”‚   â”œâ”€â”€ æ–½å·¥æ—¥èªŒ â†’ diaries, diary_attachments è¡¨                           â”‚
â”‚   â”œâ”€â”€ å“è³ªé©—æ”¶ â†’ checklists, checklist_items, task_acceptances è¡¨        â”‚
â”‚   â”œâ”€â”€ å•é¡Œè¿½è¹¤ â†’ issues è¡¨                                               â”‚
â”‚   â”œâ”€â”€ æª”æ¡ˆç®¡ç† â†’ files, file_shares è¡¨                                   â”‚
â”‚   â””â”€â”€ é€šçŸ¥ç³»çµ± â†’ notifications è¡¨                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ åŸºç¤å±¤ (Foundation Layer)

### è·è²¬ç¯„åœ

- ç”¨æˆ¶èº«ä»½è­˜åˆ¥èˆ‡èªè­‰
- çµ„ç¹”èˆ‡åœ˜éšŠç®¡ç†
- Bot ç”¨æˆ¶ç®¡ç†
- è¨‚é–±èˆ‡è¨ˆè²»ï¼ˆæœªä¾†ï¼‰

### æ ¸å¿ƒå¯¦é«”

| å¯¦é«” | è³‡æ–™è¡¨ | èªªæ˜ |
|------|--------|------|
| å¸³æˆ¶ | `accounts` | USER / ORGANIZATION / BOT ä¸‰ç¨®é¡å‹ |
| çµ„ç¹”æˆå“¡ | `organization_members` | ç”¨æˆ¶èˆ‡çµ„ç¹”çš„å¤šå°å¤šé—œè¯ |
| åœ˜éšŠ | `teams` | éš¸å±¬æ–¼çµ„ç¹”çš„å­å–®ä½ |
| åœ˜éšŠæˆå“¡ | `team_members` | ç”¨æˆ¶èˆ‡åœ˜éšŠçš„å¤šå°å¤šé—œè¯ |
| åœ˜éšŠ Bot | `team_bots` | Bot èˆ‡åœ˜éšŠçš„é—œè¯ |

### è§’è‰²é«”ç³»

```
å¹³å°å±¤ç´šè§’è‰²ï¼ˆå¸³æˆ¶é«”ç³»ï¼‰
â”œâ”€â”€ è¶…ç´šç®¡ç†å“¡ (Super Admin) - ç³»çµ±å…¨åŸŸ
â”œâ”€â”€ çµ„ç¹”æ“æœ‰è€… (Organization Owner) - çµ„ç¹”å±¤ç´š
â”œâ”€â”€ çµ„ç¹”ç®¡ç†å“¡ (Organization Admin) - çµ„ç¹”å±¤ç´š
â””â”€â”€ ä¸€èˆ¬ç”¨æˆ¶ (User) - å€‹äººå±¤ç´š
```

### å·²å¯¦ç¾æœå‹™

| æœå‹™ | ä½ç½® | èªªæ˜ |
|------|------|------|
| WorkspaceContextFacade | `core/facades/account/` | å·¥ä½œå€ä¸Šä¸‹æ–‡åˆ‡æ› |

---

## ğŸ“¦ å®¹å™¨å±¤ (Container Layer)

### è·è²¬ç¯„åœ

- è—åœ–ç”Ÿå‘½é€±æœŸç®¡ç†
- è³‡æ–™éš”é›¢ï¼ˆå¤šç§Ÿæˆ¶ï¼‰
- æ¬Šé™æ§åˆ¶
- äº‹ä»¶å»£æ’­
- æœå°‹ç´¢å¼•

### æ ¸å¿ƒå¯¦é«”

| å¯¦é«” | è³‡æ–™è¡¨ | èªªæ˜ |
|------|--------|------|
| è—åœ– | `blueprints` | é‚è¼¯å®¹å™¨ï¼Œè³‡æ–™éš”é›¢å–®ä½ |
| å·¥ä½œå€ | `workspaces` | å¾è—åœ–å¯¦ä¾‹åŒ–çš„å·¥ä½œç’°å¢ƒ |
| è—åœ–æˆå“¡ | `blueprint_members` | è—åœ–å…§çš„æˆå“¡èˆ‡è§’è‰² |
| è—åœ–è§’è‰² | `blueprint_roles` | è‡ªè¨‚è§’è‰²å®šç¾© |
| è—åœ–åˆ†æ”¯ | `blueprint_branches` | Git-like åˆ†æ”¯ï¼ˆPhase 2ï¼‰|
| åˆä½µè«‹æ±‚ | `blueprint_pull_requests` | PR ç®¡ç†ï¼ˆPhase 2ï¼‰|

### 12 é …æ ¸å¿ƒåŸºç¤è¨­æ–½

| # | åŸºç¤è¨­æ–½ | èªªæ˜ |
|---|----------|------|
| 1 | ä¸Šä¸‹æ–‡æ³¨å…¥ | è‡ªå‹•æ³¨å…¥ Blueprint/User/Permissions |
| 2 | æ¬Šé™ç³»çµ± | RBAC å¤šå±¤ç´šæ¬Šé™ |
| 3 | æ™‚é–“è»¸æœå‹™ | è·¨æ¨¡çµ„æ´»å‹•è¿½è¹¤ |
| 4 | é€šçŸ¥ä¸­å¿ƒ | å¤šæ¸ é“é€šçŸ¥è·¯ç”± |
| 5 | äº‹ä»¶ç¸½ç·š | æ¨¡çµ„é–“è§£è€¦é€šè¨Š |
| 6 | æœå°‹å¼•æ“ | è·¨æ¨¡çµ„å…¨æ–‡æª¢ç´¢ |
| 7 | é—œè¯ç®¡ç† | è·¨æ¨¡çµ„è³‡æºå¼•ç”¨ |
| 8 | è³‡æ–™éš”é›¢ | RLS å¤šç§Ÿæˆ¶éš”é›¢ |
| 9 | ç”Ÿå‘½é€±æœŸ | Draft/Active/Archived/Deleted |
| 10 | é…ç½®ä¸­å¿ƒ | è—åœ–ç´šé…ç½®ç®¡ç† |
| 11 | å…ƒæ•¸æ“šç³»çµ± | è‡ªè¨‚æ¬„ä½æ”¯æ´ |
| 12 | API é–˜é“ | å°å¤– API çµ±ä¸€å…¥å£ |

### è—åœ–è§’è‰²

```
è—åœ–å±¤ç´šè§’è‰²ï¼ˆæ¥­å‹™è§’è‰²ï¼‰
â”œâ”€â”€ å°ˆæ¡ˆç¶“ç† (Project Manager)
â”œâ”€â”€ å·¥åœ°ä¸»ä»» (Site Director)
â”œâ”€â”€ æ–½å·¥äººå“¡ (Worker)
â”œâ”€â”€ å“ç®¡äººå“¡ (QA Staff)
â””â”€â”€ è§€å¯Ÿè€… (Observer)
```

### å·²å¯¦ç¾æœå‹™

| æœå‹™ | ä½ç½® | èªªæ˜ |
|------|------|------|
| BlueprintShellComponent | `features/blueprint/shell/` | è—åœ–é‚è¼¯å®¹å™¨ |
| BlueprintStore | `features/blueprint/data-access/stores/` | è—åœ–ç‹€æ…‹ç®¡ç† |
| WorkspaceService | `features/blueprint/data-access/services/` | å·¥ä½œå€æœå‹™ |

---

## ğŸ¢ æ¥­å‹™å±¤ (Business Layer)

### è·è²¬ç¯„åœ

- å…·é«”æ¥­å‹™åŠŸèƒ½å¯¦ç¾
- é ˜åŸŸé‚è¼¯è™•ç†
- æ¥­å‹™è¦å‰‡é©—è­‰

### æ ¸å¿ƒæ¨¡çµ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ä»»å‹™ç³»çµ±      â”‚
                    â”‚   (ä¸»æ ¸å¿ƒæ¨¡çµ„)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚                   â”‚
         â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–½å·¥æ—¥èªŒ      â”‚ â”‚    å“è³ªé©—æ”¶      â”‚ â”‚    å•é¡Œè¿½è¹¤      â”‚
â”‚   (é—œè¯ä»»å‹™)     â”‚ â”‚   (é©—æ”¶ä»»å‹™)     â”‚ â”‚   (ä»»å‹™å•é¡Œ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡çµ„æ¸…å–®

| æ¨¡çµ„ | è³‡æ–™è¡¨ | ç‹€æ…‹ | å„ªå…ˆç´š |
|------|--------|------|--------|
| ä»»å‹™ç®¡ç† | `tasks`, `task_attachments`, `task_comments` | ğŸ”¶ éƒ¨åˆ†å®Œæˆ | ğŸ”´ æœ€é«˜ |
| æª”æ¡ˆç³»çµ± | `files`, `file_shares` | â¬œ å¾…å¯¦ç¾ | ğŸ”´ é«˜ |
| æ–½å·¥æ—¥èªŒ | `diaries`, `diary_attachments` | ğŸ”¶ éƒ¨åˆ†å®Œæˆ | ğŸŸ¡ é«˜ |
| é€²åº¦è¿½è¹¤ | (ä¾é™„ä»»å‹™) | â¬œ å¾…å¯¦ç¾ | ğŸŸ¡ é«˜ |
| å“è³ªé©—æ”¶ | `checklists`, `task_acceptances` | â¬œ å¾…å¯¦ç¾ | ğŸŸ¡ é«˜ |
| å•é¡Œè¿½è¹¤ | `issues` | â¬œ å¾…å¯¦ç¾ | ğŸŸ¢ ä¸­ |
| é€šçŸ¥ç³»çµ± | `notifications` | â¬œ å¾…å¯¦ç¾ | ğŸŸ¢ ä¸­ |

### å·²å¯¦ç¾æœå‹™

| æœå‹™ | ä½ç½® | èªªæ˜ |
|------|------|------|
| TaskStore | `features/blueprint/data-access/stores/` | ä»»å‹™ç‹€æ…‹ç®¡ç† |
| DiaryStore | `features/blueprint/data-access/stores/` | æ—¥èªŒç‹€æ…‹ç®¡ç† |
| TodoStore | `features/blueprint/data-access/stores/` | å¾…è¾¦ç‹€æ…‹ç®¡ç† |
| TaskTreeComponent | `features/blueprint/ui/task/` | ä»»å‹™æ¨¹ç‹€åœ– |
| TaskTableComponent | `features/blueprint/ui/task/` | ä»»å‹™è¡¨æ ¼è¦–åœ– |
| DiaryListComponent | `features/blueprint/ui/diary/` | æ—¥èªŒåˆ—è¡¨ |

---

## ğŸ”„ ä¸Šä¸‹æ–‡å‚³é

### å‚³ééˆè·¯

```
å¹³å°å±¤ç´šï¼ˆPlatform Contextï¼‰
â”‚
â”‚  WorkspaceContextFacade
â”‚  â€¢ currentContext: Signal<WorkspaceContext>
â”‚  â€¢ contextType: USER | ORGANIZATION | TEAM | BOT
â”‚  â€¢ contextId: string (account_id)
â”‚  â€¢ permissions: Signal<string[]>
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

è—åœ–å±¤ç´šï¼ˆBlueprint Contextï¼‰
â”‚
â”‚  BlueprintShellComponent (é‚è¼¯å®¹å™¨)
â”‚  â”‚
â”‚  BlueprintStore (Facade)
â”‚  â€¢ blueprintId: Signal<string>
â”‚  â€¢ workspaceId: Signal<string>
â”‚  â€¢ ownerContext: inherited from Platform
â”‚  â€¢ blueprintRole: Signal<BlueprintRole>
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ¨¡çµ„å±¤ç´š
â”‚
â”œâ”€â”€ TaskStore      â€¢ ç¹¼æ‰¿è—åœ–ä¸Šä¸‹æ–‡
â”œâ”€â”€ DiaryStore     â€¢ ç¹¼æ‰¿è—åœ–ä¸Šä¸‹æ–‡
â””â”€â”€ TodoStore      â€¢ ç¹¼æ‰¿è—åœ–ä¸Šä¸‹æ–‡
```

### å‚³éè¦å‰‡

| å±¤ç´š | æä¾›è€… | æ¶ˆè²»è€… | æ–¹å¼ |
|------|--------|--------|------|
| å¹³å° â†’ è—åœ– | WorkspaceContextFacade | BlueprintShellComponent | `inject()` DI |
| è—åœ– â†’ æ¨¡çµ„ | BlueprintStore | TaskStore, DiaryStore... | Route Params + inject() |
| æ¨¡çµ„ â†’ UI | XxxStore | XxxComponent | Angular Signals |

---

## ğŸ“‹ æ±ºç­–æª¢æŸ¥æ¸…å–®

### é–‹ç™¼æ–°åŠŸèƒ½å‰

```
â–¡ é€™å€‹åŠŸèƒ½æ¶‰åŠç”¨æˆ¶/çµ„ç¹”/èªè­‰å—ï¼Ÿ
  â””â”€â”€ æ˜¯ â†’ åŸºç¤å±¤

â–¡ é€™å€‹åŠŸèƒ½æ¶‰åŠè—åœ–/å·¥ä½œå€/æ¬Šé™å—ï¼Ÿ
  â””â”€â”€ æ˜¯ â†’ å®¹å™¨å±¤

â–¡ é€™æ˜¯æ¥­å‹™é‚è¼¯åŠŸèƒ½å—ï¼Ÿ
  â””â”€â”€ æ˜¯ â†’ æ¥­å‹™å±¤

â–¡ å·²ç¢ºèªç›¸é—œè³‡æ–™è¡¨
â–¡ å·²æª¢æŸ¥ RLS æ”¿ç­–
â–¡ å·²ç¢ºèªä¸Šä¸‹æ–‡å‚³éè·¯å¾‘
```

### ç¨‹å¼ç¢¼ä½ç½®

| å•é¡Œ | ç­”æ¡ˆ | ä½ç½® |
|------|------|------|
| é é¢è·¯ç”±ï¼Ÿ | æ˜¯ | `src/app/routes/` |
| å…±ç”¨å…ƒä»¶ï¼Ÿ | æ˜¯ | `src/app/shared/components/` |
| å…¨åŸŸæœå‹™ï¼Ÿ | æ˜¯ | `src/app/core/services/` |
| å‚ç›´åŠŸèƒ½ï¼Ÿ | æ˜¯ | `src/app/features/` |
| è—åœ–å…§åŠŸèƒ½ï¼Ÿ | æ˜¯ | `src/app/features/blueprint/ui/` |

---

## ğŸ“š åƒè€ƒæ–‡ä»¶

- [ç³»çµ±æ¶æ§‹è¨­è¨ˆåœ–](../../../docs/architecture/system-architecture.md)
- [PRD ç”¢å“éœ€æ±‚](../../../docs/prd/construction-site-management.md)
- [AI æ€ç¶­å°åœ–](../../../docs/agent/mindmap.md)

---

**æœ€å¾Œæ›´æ–°**: 2025-11-27
