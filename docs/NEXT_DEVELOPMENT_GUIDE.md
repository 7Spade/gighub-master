# ğŸ“‹ GigHub ä¸‹ä¸€æ­¥é–‹ç™¼æŒ‡å—

> åŸºæ–¼å°ˆæ¡ˆç¾æ³åˆ†æçš„é–‹ç™¼æ–¹å‘å»ºè­°ï¼ˆå·²æ›´æ–°è‡³æœ€æ–°é€²åº¦ï¼‰

**æ›´æ–°æ—¥æœŸ**: 2025-12-03

---

## ğŸ“Š å°ˆæ¡ˆç¾æ³ç¸½è¦½

### åŠŸèƒ½å®Œæˆåº¦æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®Œæˆåº¦è©•ä¼°                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºç¤å±¤ (Foundation Layer)                                       â”‚
â”‚   âœ… èªè­‰ç³»çµ± (Supabase Auth)                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   âœ… ä½¿ç”¨è€…ç®¡ç†                               â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   âœ… çµ„ç¹”ç®¡ç†                                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   ğŸ”¶ Bot ç®¡ç†                                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 50%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¹å™¨å±¤ (Container Layer)                                        â”‚
â”‚   âœ… è—åœ–ç³»çµ±                                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   âœ… è—åœ–æˆå“¡ç®¡ç†                             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   ğŸ”¶ æ¬Šé™æ§åˆ¶ (RBAC)                          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 70%  â”‚
â”‚   ğŸ”´ äº‹ä»¶ç¸½ç·š                                 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”‚   ğŸ”´ æœå°‹å¼•æ“                                 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¥­å‹™å±¤ (Business Layer)                                         â”‚
â”‚   âœ… ä»»å‹™ç®¡ç† (Task Module)                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%  â”‚
â”‚   âœ… è²¡å‹™ç®¡ç† (Financial Module)              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 70%  â”‚
â”‚   ğŸ”¶ æ—¥èªŒç®¡ç† (Diary Module)                  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 15%  â”‚
â”‚   ğŸ”¶ å¾…è¾¦äº‹é … (Todo Module)                   â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35%  â”‚
â”‚   ğŸ”´ å“è³ªé©—æ”¶ (Acceptance)                    â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”‚   ğŸ”´ æª”æ¡ˆç®¡ç† (File Module)                   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”‚   ğŸ”´ å•é¡Œè¿½è¹¤ (Issue Module)                  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”‚   ğŸ”´ é€šçŸ¥ä¸­å¿ƒ (Notification)                  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ‰ æœ€æ–°å®Œæˆé€²åº¦

ä»¥ä¸‹æ¨¡çµ„å·²æ–¼è¿‘æœŸå®Œæˆé‡å¤§æ›´æ–°ï¼š

| æ¨¡çµ„ | å®Œæˆé …ç›® | ç‹€æ…‹ |
|------|---------|------|
| **ä»»å‹™ç®¡ç†** | TaskRepository + TaskService å®Œæ•´å¯¦ä½œ | âœ… 85% |
| **è—åœ–ç®¡ç†** | BlueprintRepository + BlueprintService å®Œæ•´å¯¦ä½œ | âœ… å®Œæˆ |
| **è²¡å‹™ç®¡ç†** | FinancialRepository + FinancialService å®Œæ•´å¯¦ä½œ | âœ… 70% |
| **è—åœ–æˆå“¡** | BlueprintMemberRepository å®Œæ•´å¯¦ä½œ | âœ… å®Œæˆ |
| **æ¬Šé™æ§åˆ¶** | PermissionService åŸºç¤å¯¦ä½œ | ğŸ”¶ 70% |

### æŠ€è¡“æ¶æ§‹ç¾æ³

| å±¤ç´š | å…ƒä»¶ | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|------|
| **Repository å±¤** | TaskRepository | âœ… å®Œæˆ | å®Œæ•´ CRUD + æŸ¥è©¢é¸é … |
| **Repository å±¤** | BlueprintRepository | âœ… å®Œæˆ | å®Œæ•´ CRUD + æˆå“¡ç®¡ç† |
| **Repository å±¤** | FinancialRepository | âœ… å®Œæˆ | åˆç´„ã€è²»ç”¨ã€è«‹æ¬¾ã€ä»˜æ¬¾ç®¡ç† |
| **Repository å±¤** | DiaryRepository | ğŸ”´ å¾…å»ºç«‹ | æ—¥èªŒè³‡æ–™å­˜å–å±¤ |
| **Repository å±¤** | FileRepository | ğŸ”´ å¾…å»ºç«‹ | æª”æ¡ˆè³‡æ–™å­˜å–å±¤ |
| **Service å±¤** | TaskService | âœ… å®Œæˆ | ä½¿ç”¨ Signals + linkedSignal |
| **Service å±¤** | BlueprintService | âœ… å®Œæˆ | å®Œæ•´æ¥­å‹™é‚è¼¯ |
| **Service å±¤** | FinancialService | âœ… å®Œæˆ | è²¡å‹™æ¥­å‹™é‚è¼¯ |
| **UI å…ƒä»¶** | TasksComponent | âœ… å®Œæˆ | æ¨¹ç‹€/è¡¨æ ¼/çœ‹æ¿è¦–åœ– |
| **UI å…ƒä»¶** | TaskEditDrawerComponent | âœ… å®Œæˆ | ä»»å‹™ç·¨è¼¯æŠ½å±œ |

---

## ğŸ¯ é–‹ç™¼å„ªå…ˆç´šå»ºè­°

åŸºæ–¼å°ˆæ¡ˆç¾æ³åˆ†æï¼Œä»¥ä¸‹æ˜¯å»ºè­°çš„é–‹ç™¼å„ªå…ˆé †åºï¼š

### ğŸ”´ æœ€é«˜å„ªå…ˆç´š - ç«‹å³åŸ·è¡Œ (1-2 é€±)

#### 1. æ–½å·¥æ—¥èªŒæ¨¡çµ„ (Diary Module) â­â­â­â­â­

**ç¾æ³**ï¼šè³‡æ–™åº«å·²è¨­è¨ˆå®Œæˆï¼Œå‰ç«¯å’Œæœå‹™å±¤å°šæœªå¯¦ä½œ

**å¾…å®Œæˆé …ç›®**ï¼š
1. **DiaryRepository** - æ—¥èªŒè³‡æ–™å­˜å–å±¤
2. **DiaryService** - æ—¥èªŒæ¥­å‹™é‚è¼¯ï¼ˆä½¿ç”¨ Signalsï¼‰
3. **æ—¥èªŒåˆ—è¡¨é é¢** - `routes/blueprint/diary/diary-list/`
4. **æ—¥èªŒå»ºç«‹/ç·¨è¼¯è¡¨å–®** - `routes/blueprint/diary/diary-form/`
5. **æ—¥èªŒæ¢ç›®ç®¡ç†** - å·¥ä½œé …ç›®è¨˜éŒ„
6. **å¤©æ°£é¸æ“‡å™¨** - åŸºæ–¼ `weather_type` æšèˆ‰

**å·²æœ‰è³‡æ–™è¡¨**ï¼š
- `diaries` - æ—¥èªŒä¸»è¡¨
- `diary_attachments` - æ—¥èªŒé™„ä»¶

**ç‚ºä»€éº¼å„ªå…ˆ**ï¼š
- å·¥åœ°ä¸»ä»»æ¯æ—¥å¿…ç”¨åŠŸèƒ½
- æ³•è¦è¦æ±‚çš„æ–½å·¥ç´€éŒ„
- è³‡æ–™åº«çµæ§‹å·²å°±ç·’
- å¯åƒè€ƒ TaskModule çš„æ¶æ§‹æ¨¡å¼

**å»ºè­°æª”æ¡ˆçµæ§‹**ï¼š
```
src/app/
â”œâ”€â”€ core/infra/repositories/diary/
â”‚   â”œâ”€â”€ diary.repository.ts      â† å¾…å»ºç«‹
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ shared/services/diary/
â”‚   â”œâ”€â”€ diary.service.ts         â† å¾…å»ºç«‹
â”‚   â””â”€â”€ index.ts
â””â”€â”€ routes/blueprint/diary/
    â”œâ”€â”€ diary-list/              â† å¾…å»ºç«‹
    â”œâ”€â”€ diary-form/              â† å¾…å»ºç«‹
    â””â”€â”€ routes.ts                â† å¾…å»ºç«‹
```

---

### ğŸŸ  é«˜å„ªå…ˆç´š - çŸ­æœŸç›®æ¨™ (2-4 é€±)

#### 2. æª”æ¡ˆç®¡ç†æ¨¡çµ„ (File Module) â­â­â­â­

**ç¾æ³**ï¼šè³‡æ–™åº«çµæ§‹å·²åœ¨ `seed.sql` ä¸­è¨­è¨ˆï¼Œå‰ç«¯æœªé–‹å§‹

**å¾…å®Œæˆé …ç›®**ï¼š
1. **Supabase Storage é…ç½®** - bucket è¨­å®šå’Œæ¬Šé™
2. **FileRepository** - è³‡æ–™å­˜å–å±¤
3. **FileService** - æª”æ¡ˆæ¥­å‹™é‚è¼¯
4. **æª”æ¡ˆä¸Šå‚³å…ƒä»¶** - æ‹–æ‹‰ä¸Šå‚³ UI
5. **æª”æ¡ˆé è¦½** - åœ–ç‰‡/PDF é è¦½
6. **æª”æ¡ˆåˆ†äº«** - `file_shares` è¡¨æ•´åˆ

**å·²æœ‰è³‡æ–™è¡¨**ï¼š
- `files` - æª”æ¡ˆä¸»è¡¨
- `file_shares` - æª”æ¡ˆåˆ†äº«

**ä¾è³´é—œä¿‚**ï¼š
- æ—¥èªŒç…§ç‰‡ä¸Šå‚³éœ€è¦æ­¤æ¨¡çµ„
- ä»»å‹™é™„ä»¶éœ€è¦æ­¤æ¨¡çµ„

#### 3. ä»»å‹™æ¨¡çµ„å®Œå–„ â­â­â­â­

**ç¾æ³**ï¼šæ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼ˆ85%ï¼‰ï¼Œéœ€å®Œå–„ç´°ç¯€

**å¾…å®Œæˆé …ç›®**ï¼š
1. **ç§»é™¤ mock è³‡æ–™ç›¸é—œç¨‹å¼ç¢¼** - æ¸…ç† `generateMockTasks` ç­‰å·²æ£„ç”¨æ–¹æ³•
2. **ä»»å‹™é™„ä»¶åŠŸèƒ½** - æ•´åˆ `task_attachments` è³‡æ–™è¡¨
3. **ä»»å‹™æŒ‡æ´¾é€šçŸ¥** - æ•´åˆé€šçŸ¥ç³»çµ±
4. **ä»»å‹™è©•è«–åŠŸèƒ½** - è¨è«–å’Œç•™è¨€ï¼ˆéœ€æ–°å¢ `task_comments` è¡¨ï¼‰
5. **æ‹–æ›³æ’åº** - ä»»å‹™é †åºèª¿æ•´

---

### ğŸŸ¡ ä¸­å„ªå…ˆç´š - ä¸­æœŸç›®æ¨™ (4-6 é€±)

#### 4. æ¬Šé™æ§åˆ¶å®Œå–„ â­â­â­

**ç¾æ³**ï¼šåŸºç¤ RBAC å·²å¯¦ç¾ï¼ˆ70%ï¼‰ï¼Œç´°ç²’åº¦æ¬Šé™æ§åˆ¶ä¸å®Œæ•´

**å¾…å®Œæˆé …ç›®**ï¼š
1. **blueprint_roles æ•´åˆ** - è‡ªè¨‚è§’è‰²ç³»çµ±
2. **æ¬Šé™ Guard å¼·åŒ–** - è·¯ç”±å±¤æ¬Šé™æ§åˆ¶
3. **UI æ¬Šé™æ§åˆ¶** - æŒ‰éˆ•/æ“ä½œçš„æ¢ä»¶é¡¯ç¤º
4. **PermissionDirective** - æ¬Šé™æŒ‡ä»¤å…ƒä»¶

#### 5. å•é¡Œè¿½è¹¤æ¨¡çµ„ (Issue Module) â­â­â­

**ç¾æ³**ï¼šè³‡æ–™è¡¨å·²è¨­è¨ˆ (`issues`, `issue_comments`)ï¼Œå‰ç«¯æœªå¯¦ç¾

**å¾…å®Œæˆé …ç›®**ï¼š
1. **IssueRepository** - å•é¡Œè³‡æ–™å­˜å–å±¤
2. **IssueService** - å•é¡Œæ¥­å‹™é‚è¼¯
3. **å•é¡Œåˆ—è¡¨/è©³æƒ…é é¢** - UI å…ƒä»¶
4. **å•é¡Œè©•è«–åŠŸèƒ½** - è¨è«–ç•™è¨€

#### 6. é€šçŸ¥ä¸­å¿ƒæ¨¡çµ„ â­â­â­

**ç¾æ³**ï¼šè³‡æ–™è¡¨å·²è¨­è¨ˆ (`notifications`, `notification_preferences`)ï¼Œå‰ç«¯æœªå¯¦ç¾

**å¾…å®Œæˆé …ç›®**ï¼š
1. **NotificationRepository** - é€šçŸ¥è³‡æ–™å­˜å–å±¤
2. **NotificationService** - é€šçŸ¥æ¥­å‹™é‚è¼¯
3. **é€šçŸ¥ä¸­å¿ƒ UI** - é€šçŸ¥åˆ—è¡¨ã€æœªè®€æ¨™è¨˜
4. **Supabase Realtime æ•´åˆ** - å³æ™‚é€šçŸ¥æ¨é€

---

### ğŸŸ¢ ä¸€èˆ¬å„ªå…ˆç´š - é•·æœŸç›®æ¨™ (6+ é€±)

#### 7. å“è³ªé©—æ”¶æ¨¡çµ„ â­â­

**ç¾æ³**ï¼šè³‡æ–™è¡¨å·²è¨­è¨ˆ (`task_acceptances`, `checklists`, `checklist_items`)

**å¾…å»ºç«‹**ï¼š
- é©—æ”¶æ¸…å–®ç³»çµ±
- é©—æ”¶æµç¨‹ç®¡ç†
- é©—æ”¶å ±å‘Šç”¢ç”Ÿ

#### 8. äº‹ä»¶ç¸½ç·šç³»çµ± â­â­

**ç¾æ³**ï¼šè³‡æ–™è¡¨å·²è¨­è¨ˆ (`events`, `event_subscriptions`)

**å¾…å»ºç«‹**ï¼š
- äº‹ä»¶ç™¼å¸ƒ/è¨‚é–±æ©Ÿåˆ¶
- æ¨¡çµ„é–“é€šè¨Š
- è‡ªå‹•åŒ–è§¸ç™¼å™¨

#### 9. æœå°‹å¼•æ“ â­

**ç¾æ³**ï¼šè³‡æ–™è¡¨å·²è¨­è¨ˆ (`search_index`)

**å¾…å»ºç«‹**ï¼š
- å…¨æ–‡æª¢ç´¢åŠŸèƒ½
- æœå°‹çµæœé é¢
- æœå°‹å»ºè­°

---

## ğŸ“ ç¾æœ‰ç›®éŒ„çµæ§‹åƒè€ƒ

### Repository å±¤ï¼ˆå·²å®Œæˆï¼‰
```
src/app/core/infra/repositories/
â”œâ”€â”€ account/
â”‚   â”œâ”€â”€ account.repository.ts    âœ…
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ blueprint/
â”‚   â”œâ”€â”€ blueprint.repository.ts  âœ…
â”‚   â”œâ”€â”€ blueprint-member.repository.ts âœ…
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ financial/
â”‚   â”œâ”€â”€ financial.repository.ts  âœ…
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ task/
â”‚   â”œâ”€â”€ task.repository.ts       âœ…
â”‚   â””â”€â”€ index.ts
â””â”€â”€ index.ts
```

### Service å±¤ï¼ˆå·²å®Œæˆï¼‰
```
src/app/shared/services/
â”œâ”€â”€ account/
â”‚   â””â”€â”€ account.service.ts       âœ…
â”œâ”€â”€ blueprint/
â”‚   â””â”€â”€ blueprint.service.ts     âœ…
â”œâ”€â”€ financial/
â”‚   â””â”€â”€ financial.service.ts     âœ…
â”œâ”€â”€ task/
â”‚   â””â”€â”€ task.service.ts          âœ…
â”œâ”€â”€ menu/
â”‚   â””â”€â”€ menu.service.ts          âœ…
â”œâ”€â”€ permission/
â”‚   â””â”€â”€ permission.service.ts    ğŸ”¶
â””â”€â”€ index.ts
```

### è·¯ç”±é é¢ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
```
src/app/routes/
â”œâ”€â”€ blueprint/
â”‚   â”œâ”€â”€ list/                    âœ… è—åœ–åˆ—è¡¨
â”‚   â”œâ”€â”€ create-blueprint/        âœ… å»ºç«‹è—åœ–
â”‚   â”œâ”€â”€ overview/                âœ… è—åœ–ç¸½è¦½
â”‚   â”œâ”€â”€ members/                 âœ… æˆå“¡ç®¡ç†
â”‚   â”œâ”€â”€ tasks/                   âœ… ä»»å‹™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tasks.component.ts
â”‚   â”‚   â””â”€â”€ task-edit-drawer.component.ts
â”‚   â”œâ”€â”€ diary/                   ğŸ”´ å¾…å»ºç«‹
â”‚   â”œâ”€â”€ files/                   ğŸ”´ å¾…å»ºç«‹
â”‚   â””â”€â”€ routes.ts
â”œâ”€â”€ account/                     âœ…
â”œâ”€â”€ passport/                    âœ…
â””â”€â”€ ...
```

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œå»ºè­°

### 1. DiaryRepository åƒè€ƒå¯¦ä½œ

```typescript
// src/app/core/infra/repositories/diary/diary.repository.ts
import { Injectable, inject } from '@angular/core';
import { Observable, from, map } from 'rxjs';
import { SupabaseService } from '@core/supabase';

export interface Diary {
  id: string;
  blueprint_id: string;
  work_date: string;
  weather: string | null;
  temperature_min: number | null;
  temperature_max: number | null;
  work_hours: number | null;
  worker_count: number | null;
  summary: string | null;
  notes: string | null;
  status: string;
  created_by: string | null;
  approved_by: string | null;
  approved_at: string | null;
  created_at: string;
  updated_at: string;
}

@Injectable({ providedIn: 'root' })
export class DiaryRepository {
  private readonly supabase = inject(SupabaseService);

  findByBlueprint(blueprintId: string): Observable<Diary[]> {
    return from(
      this.supabase.client
        .from('diaries')
        .select('*')
        .eq('blueprint_id', blueprintId)
        .is('deleted_at', null)
        .order('work_date', { ascending: false })
    ).pipe(
      map(({ data, error }) => {
        if (error) {
          console.error('[DiaryRepository] findByBlueprint error:', error);
          return [];
        }
        return (data || []) as Diary[];
      })
    );
  }

  findByDate(blueprintId: string, date: string): Observable<Diary | null> {
    return from(
      this.supabase.client
        .from('diaries')
        .select('*')
        .eq('blueprint_id', blueprintId)
        .eq('work_date', date)
        .is('deleted_at', null)
        .single()
    ).pipe(
      map(({ data, error }) => {
        if (error) return null;
        return data as Diary;
      })
    );
  }

  create(diary: Partial<Diary>): Observable<Diary | null> {
    return from(
      this.supabase.client
        .from('diaries')
        .insert(diary)
        .select()
        .single()
    ).pipe(
      map(({ data, error }) => {
        if (error) {
          console.error('[DiaryRepository] create error:', error);
          return null;
        }
        return data as Diary;
      })
    );
  }

  update(id: string, updates: Partial<Diary>): Observable<Diary | null> {
    return from(
      this.supabase.client
        .from('diaries')
        .update({ ...updates, updated_at: new Date().toISOString() })
        .eq('id', id)
        .select()
        .single()
    ).pipe(
      map(({ data, error }) => {
        if (error) {
          console.error('[DiaryRepository] update error:', error);
          return null;
        }
        return data as Diary;
      })
    );
  }
}
```

### 2. DiaryService åƒè€ƒå¯¦ä½œ

```typescript
// src/app/shared/services/diary/diary.service.ts
import { Injectable, inject, signal, computed } from '@angular/core';
import { DiaryRepository, Diary } from '@core';
import { firstValueFrom } from 'rxjs';

@Injectable({ providedIn: 'root' })
export class DiaryService {
  private readonly repo = inject(DiaryRepository);

  // State signals
  private diariesState = signal<Diary[]>([]);
  private loadingState = signal<boolean>(false);
  private errorState = signal<string | null>(null);

  // Readonly signals
  readonly diaries = this.diariesState.asReadonly();
  readonly loading = this.loadingState.asReadonly();
  readonly error = this.errorState.asReadonly();

  // Computed signals
  readonly diaryCount = computed(() => this.diariesState().length);
  readonly hasError = computed(() => this.errorState() !== null);

  async loadDiaries(blueprintId: string): Promise<Diary[]> {
    this.loadingState.set(true);
    this.errorState.set(null);

    try {
      const diaries = await firstValueFrom(this.repo.findByBlueprint(blueprintId));
      this.diariesState.set(diaries);
      return diaries;
    } catch (err) {
      const message = err instanceof Error ? err.message : 'è¼‰å…¥æ—¥èªŒå¤±æ•—';
      this.errorState.set(message);
      throw err;
    } finally {
      this.loadingState.set(false);
    }
  }

  async createDiary(diary: Partial<Diary>): Promise<Diary | null> {
    const newDiary = await firstValueFrom(this.repo.create(diary));
    if (newDiary) {
      this.diariesState.update(list => [newDiary, ...list]);
    }
    return newDiary;
  }

  async updateDiary(id: string, updates: Partial<Diary>): Promise<Diary | null> {
    const updated = await firstValueFrom(this.repo.update(id, updates));
    if (updated) {
      this.diariesState.update(list =>
        list.map(d => d.id === id ? updated : d)
      );
    }
    return updated;
  }
}
```

---

## ğŸ“ ç«‹å³è¡Œå‹•æ¸…å–®

### æœ¬é€± (Week 1) - æ—¥èªŒæ¨¡çµ„åŸºç¤å»ºè¨­

- [ ] **å»ºç«‹ DiaryRepository**
  ```bash
  # å»ºç«‹ç›®éŒ„å’Œæª”æ¡ˆ
  mkdir -p src/app/core/infra/repositories/diary
  touch src/app/core/infra/repositories/diary/diary.repository.ts
  touch src/app/core/infra/repositories/diary/index.ts
  ```
- [ ] **å»ºç«‹ DiaryService**
  ```bash
  mkdir -p src/app/shared/services/diary
  touch src/app/shared/services/diary/diary.service.ts
  touch src/app/shared/services/diary/index.ts
  ```
- [ ] **æ›´æ–° core/index.ts** å°å‡º DiaryRepository
- [ ] **æ›´æ–° shared/index.ts** å°å‡º DiaryService

### ä¸‹é€± (Week 2) - æ—¥èªŒæ¨¡çµ„ UI

- [ ] **å»ºç«‹æ—¥èªŒè·¯ç”±é é¢**
  ```bash
  mkdir -p src/app/routes/blueprint/diary
  touch src/app/routes/blueprint/diary/diary-list.component.ts
  touch src/app/routes/blueprint/diary/diary-form.component.ts
  touch src/app/routes/blueprint/diary/routes.ts
  ```
- [ ] **æ›´æ–°è—åœ–è·¯ç”±** - åŠ å…¥æ—¥èªŒæ¨¡çµ„è·¯ç”±
- [ ] **å»ºç«‹å¤©æ°£é¸æ“‡å™¨å…ƒä»¶** - ä½¿ç”¨ `weather_type` æšèˆ‰
- [ ] **æ—¥èªŒé™„ä»¶åŠŸèƒ½** - æ•´åˆ `diary_attachments` è¡¨

### ç¬¬ä¸‰é€± (Week 3) - æª”æ¡ˆç®¡ç†æ¨¡çµ„

- [ ] **é…ç½® Supabase Storage** - å»ºç«‹ bucket å’Œæ¬Šé™
- [ ] **å»ºç«‹ FileRepository** è³‡æ–™å­˜å–å±¤
- [ ] **å»ºç«‹ FileService** æ¥­å‹™é‚è¼¯
- [ ] **å»ºç«‹æª”æ¡ˆä¸Šå‚³å…ƒä»¶** - æ‹–æ‹‰ä¸Šå‚³
- [ ] **æ•´åˆåˆ°æ—¥èªŒé™„ä»¶** - ç…§ç‰‡ä¸Šå‚³åŠŸèƒ½

### ç¬¬å››é€± (Week 4) - æ¸…ç†å’Œå„ªåŒ–

- [ ] **æ¸…ç† TaskService mock ç¨‹å¼ç¢¼** - ç§»é™¤å·²æ£„ç”¨æ–¹æ³•
- [ ] **ä»»å‹™é™„ä»¶åŠŸèƒ½** - æ•´åˆ FileService
- [ ] **æ¬Šé™æ§åˆ¶å¼·åŒ–** - PermissionDirective
- [ ] **æ¸¬è©¦å’Œæ–‡ä»¶æ›´æ–°**

---

## ğŸ”„ ç‰ˆæœ¬ç‹€æ…‹

### ç•¶å‰ç‰ˆæœ¬

| å¥—ä»¶ | ç‰ˆæœ¬ | ç‹€æ…‹ |
|------|------|------|
| @angular/core | 20.3.0 | âœ… æœ€æ–° |
| @delon/abc | 20.1.0 | âœ… æœ€æ–° |
| ng-zorro-antd | 20.4.3 | âœ… æœ€æ–° |
| @supabase/supabase-js | 2.86.0 | âœ… æœ€æ–° |
| TypeScript | 5.9.2 | âœ… æœ€æ–° |

### Angular 20 ç‰¹æ€§ä½¿ç”¨æƒ…æ³

| ç‰¹æ€§ | ä½¿ç”¨ç‹€æ…‹ | æª”æ¡ˆç¯„ä¾‹ |
|------|---------|---------|
| `signal()`, `computed()` | âœ… å»£æ³›ä½¿ç”¨ | TaskService, BlueprintService |
| `linkedSignal()` | âœ… å·²ä½¿ç”¨ | TaskService.selectedTask |
| `inject()` å‡½æ•¸ | âœ… æ¨™æº–ä½¿ç”¨ | æ‰€æœ‰ Service å’Œ Repository |
| `input()`, `output()` | âœ… éƒ¨åˆ†ä½¿ç”¨ | TaskEditDrawerComponent |
| `@if`, `@for`, `@switch` | âœ… æ¨™æº–ä½¿ç”¨ | æ‰€æœ‰ Component æ¨¡æ¿ |
| `toSignal()`, `toObservable()` | ğŸ”¶ éƒ¨åˆ†ä½¿ç”¨ | å¯æ“´å±•ä½¿ç”¨ |

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [ç³»çµ±æ¶æ§‹](GigHub_Architecture.md)
- [åŠŸèƒ½æ–‡ä»¶](features/README.md)
- [ç”¢å“éœ€æ±‚](prd/construction-site-management.md)
- [Supabase Schema](../seed.sql)
- [Angular å®˜æ–¹æ–‡æª”](https://angular.dev)
- [ng-alain æ–‡æª”](https://ng-alain.com)
- [ng-zorro-antd æ–‡æª”](https://ng.ant.design)
- [Supabase æ–‡æª”](https://supabase.com/docs)

---

## ğŸ¯ ç¸½çµ

åŸºæ–¼å°ˆæ¡ˆæœ€æ–°åˆ†æï¼Œ**å»ºè­°çš„é–‹ç™¼é †åº**ç‚ºï¼š

1. **ğŸ“Œ æ–½å·¥æ—¥èªŒæ¨¡çµ„** (æœ€é«˜å„ªå…ˆ) 
   - æ ¸å¿ƒæ¥­å‹™éœ€æ±‚
   - è³‡æ–™åº«çµæ§‹å·²å°±ç·’
   - å¯åƒè€ƒ TaskModule æ¶æ§‹

2. **ğŸ“Œ æª”æ¡ˆç®¡ç†æ¨¡çµ„** (é«˜å„ªå…ˆ)
   - æ”¯æ´æ—¥èªŒå’Œä»»å‹™é™„ä»¶
   - Supabase Storage æ•´åˆ

3. **ğŸ“Œ ä»»å‹™æ¨¡çµ„å®Œå–„** (é«˜å„ªå…ˆ)
   - æ¸…ç† mock ç¨‹å¼ç¢¼
   - é™„ä»¶å’Œè©•è«–åŠŸèƒ½

4. **ğŸ“Œ æ¬Šé™æ§åˆ¶å®Œå–„** (ä¸­å„ªå…ˆ)
   - PermissionDirective
   - ç´°ç²’åº¦å­˜å–æ§åˆ¶

5. **å…¶ä»–æ¨¡çµ„** - æŒ‰éœ€é–‹ç™¼

### ğŸš€ ç«‹å³é–‹å§‹çš„ç¬¬ä¸€æ­¥

```bash
# 1. å»ºç«‹ DiaryRepository
mkdir -p src/app/core/infra/repositories/diary

# 2. å»ºç«‹ DiaryService  
mkdir -p src/app/shared/services/diary

# 3. å»ºç«‹æ—¥èªŒé é¢è·¯ç”±
mkdir -p src/app/routes/blueprint/diary
```

---

**æœ€å¾Œæ›´æ–°**: 2025-12-03
**åˆ†æåŸºæº–**: å°ˆæ¡ˆæœ€æ–°ç¨‹å¼ç¢¼ç‹€æ…‹
