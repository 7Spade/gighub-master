# ğŸ“‹ GigHub ä¸‹ä¸€æ­¥é–‹ç™¼æŒ‡å—

> åŸºæ–¼å°ˆæ¡ˆç¾æ³åˆ†æçš„é–‹ç™¼æ–¹å‘å»ºè­°

**å»ºç«‹æ—¥æœŸ**: 2025-12-02

---

## ğŸ“Š å°ˆæ¡ˆç¾æ³ç¸½è¦½

### åŠŸèƒ½å®Œæˆåº¦æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®Œæˆåº¦è©•ä¼°                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºç¤å±¤ (Foundation Layer)                                       â”‚
â”‚   âœ… èªè­‰ç³»çµ± (Supabase Auth)                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   âœ… ä½¿ç”¨è€…ç®¡ç†                               â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   âœ… çµ„ç¹”ç®¡ç†                                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   ğŸ”¶ Bot ç®¡ç†                                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 50%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¹å™¨å±¤ (Container Layer)                                        â”‚
â”‚   âœ… è—åœ–ç³»çµ±                                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å®Œæˆ â”‚
â”‚   ğŸ”¶ æ¬Šé™æ§åˆ¶ (RBAC)                          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 70%  â”‚
â”‚   ğŸ”´ äº‹ä»¶ç¸½ç·š                                 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”‚   ğŸ”´ æœå°‹å¼•æ“                                 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¥­å‹™å±¤ (Business Layer)                                         â”‚
â”‚   ğŸ”¶ ä»»å‹™ç®¡ç†                                 â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 30%  â”‚
â”‚   ğŸ”¶ æ—¥èªŒç®¡ç†                                 â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 15%  â”‚
â”‚   ğŸ”¶ å¾…è¾¦äº‹é …                                 â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35%  â”‚
â”‚   ğŸ”´ å“è³ªé©—æ”¶                                 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â”‚   ğŸ”´ æª”æ¡ˆç®¡ç†                                 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“ | ç‰ˆæœ¬ | èªªæ˜ |
|------|------|------|------|
| å‰ç«¯æ¡†æ¶ | Angular (Standalone Components) | 20.3+ | ä½¿ç”¨ Signals, inject(), @if/@for æ§åˆ¶æµ |
| UI æ¡†æ¶ | NG-ZORRO + @delon/abc | 20.x | ä¼æ¥­ç´š UI å…ƒä»¶åº« |
| ç‹€æ…‹ç®¡ç† | Angular Signals | 20.3+ | signal(), computed(), linkedSignal() |
| å¾Œç«¯æœå‹™ | Supabase (PostgreSQL + Auth) | 2.86+ | BaaS å¾Œç«¯æœå‹™ |
| å‹åˆ¥ç³»çµ± | TypeScript | 5.9 | å®Œæ•´é¡å‹å®‰å…¨ |
| éŸ¿æ‡‰å¼ | RxJS | 7.8 | æ­é… toSignal()/toObservable() |

---

## ğŸ¯ é–‹ç™¼å„ªå…ˆç´šå»ºè­°

åŸºæ–¼å°ˆæ¡ˆç¾æ³åˆ†æï¼Œä»¥ä¸‹æ˜¯å»ºè­°çš„é–‹ç™¼å„ªå…ˆé †åºï¼š

### ğŸ”´ æœ€é«˜å„ªå…ˆç´š - ç«‹å³åŸ·è¡Œ (1-2 é€±)

#### 1. ä»»å‹™ç®¡ç†æ¨¡çµ„å®Œå–„ â­â­â­â­â­

**ç¾æ³**ï¼šUI æ¡†æ¶å·²å®Œæˆï¼ˆæ¨¹ç‹€åœ–ã€è¡¨æ ¼ã€çœ‹æ¿è¦–åœ–ï¼‰ï¼Œä½†å¾Œç«¯æ•´åˆä¸å®Œæ•´

**å¾…å®Œæˆé …ç›®**ï¼š
1. **TaskRepository è³‡æ–™å­˜å–å±¤** - é€£æ¥ Supabase
2. **ä»»å‹™ RPC å‡½æ•¸** - å»ºç«‹/æ›´æ–°/åˆªé™¤ä»»å‹™çš„åŸå­æ“ä½œ
3. **ä»»å‹™æŒ‡æ´¾åŠŸèƒ½** - é€£æ¥ `task_assignees` è³‡æ–™è¡¨
4. **é€²åº¦è¨ˆç®—** - å¾è‘‰ç¯€é»å‘ä¸Šè¨ˆç®—çˆ¶ä»»å‹™é€²åº¦
5. **ç§»é™¤ Mock è³‡æ–™** - åˆ‡æ›åˆ°çœŸå¯¦è³‡æ–™åº«æ“ä½œ

**æ¶‰åŠæª”æ¡ˆ**ï¼š
```
src/app/
â”œâ”€â”€ core/infra/repositories/task/        â† å¾…å»ºç«‹
â”œâ”€â”€ shared/services/task/task.service.ts â† éœ€ä¿®æ”¹ï¼ˆç§»é™¤ mockï¼‰
â””â”€â”€ routes/blueprint/tasks/              â† å·²å®Œæˆ UI
```

**ç‚ºä»€éº¼å„ªå…ˆ**ï¼š
- ä»»å‹™æ˜¯æ ¸å¿ƒæ¥­å‹™æ¨¡çµ„ï¼Œæ‰€æœ‰å…¶ä»–åŠŸèƒ½ä¾é™„æ–¼æ­¤
- UI å·²å®Œæˆï¼Œåªéœ€å®Œæˆå¾Œç«¯æ•´åˆ
- è³‡æ–™åº« schema å·²è¨­è¨ˆå®Œæˆ

---

### ğŸŸ  é«˜å„ªå…ˆç´š - çŸ­æœŸç›®æ¨™ (2-4 é€±)

#### 2. æ–½å·¥æ—¥èªŒæ¨¡çµ„ â­â­â­â­

**ç¾æ³**ï¼šè³‡æ–™åº«å·²è¨­è¨ˆï¼Œå‰ç«¯åƒ…æœ‰åˆ—è¡¨æ¡†æ¶

**å¾…å®Œæˆé …ç›®**ï¼š
1. **DiaryRepository** - è³‡æ–™å­˜å–å±¤
2. **æ—¥èªŒå»ºç«‹è¡¨å–®** - å®Œæ•´çš„æ—¥èªŒå¡«å¯« UI
3. **æ—¥èªŒæ¢ç›®ç®¡ç†** - `daily_log_entries` æ•´åˆ
4. **ç…§ç‰‡ä¸Šå‚³** - Supabase Storage æ•´åˆ
5. **å¤©æ°£é¸æ“‡å™¨** - åŸºæ–¼ `weather_type` æšèˆ‰

**ç›¸é—œè³‡æ–™è¡¨**ï¼š
- `daily_logs` - æ—¥èªŒä¸»è¡¨
- `daily_log_entries` - æ—¥èªŒæ¢ç›®

**å•†æ¥­åƒ¹å€¼**ï¼š
- å·¥åœ°ä¸»ä»»æ¯æ—¥å¿…ç”¨åŠŸèƒ½
- æ³•è¦è¦æ±‚çš„æ–½å·¥ç´€éŒ„

#### 3. æª”æ¡ˆç®¡ç†æ¨¡çµ„ â­â­â­â­

**ç¾æ³**ï¼šè³‡æ–™åº«çµæ§‹å·²åœ¨ `seed.sql` ä¸­è¨­è¨ˆï¼Œå‰ç«¯æœªé–‹å§‹

**å¾…å®Œæˆé …ç›®**ï¼š
1. **Supabase Storage é…ç½®** - bucket è¨­å®š
2. **FileRepository** - è³‡æ–™å­˜å–å±¤
3. **FileService** - æ¥­å‹™é‚è¼¯
4. **æª”æ¡ˆä¸Šå‚³å…ƒä»¶** - æ‹–æ‹‰ä¸Šå‚³ UI
5. **æª”æ¡ˆé è¦½** - åœ–ç‰‡/PDF é è¦½

**ä¾è³´é—œä¿‚**ï¼š
- æ—¥èªŒç…§ç‰‡ä¸Šå‚³éœ€è¦æ­¤æ¨¡çµ„
- ä»»å‹™é™„ä»¶éœ€è¦æ­¤æ¨¡çµ„

---

### ğŸŸ¡ ä¸­å„ªå…ˆç´š - ä¸­æœŸç›®æ¨™ (4-6 é€±)

#### 4. æ¬Šé™æ§åˆ¶å®Œå–„ â­â­â­

**ç¾æ³**ï¼šåŸºç¤ RBAC å·²å¯¦ç¾ï¼Œä½†ç´°ç²’åº¦æ¬Šé™æ§åˆ¶ä¸å®Œæ•´

**å¾…å®Œæˆé …ç›®**ï¼š
1. **blueprint_roles æ•´åˆ** - è‡ªè¨‚è§’è‰²ç³»çµ±
2. **æ¬Šé™ Guard å¼·åŒ–** - è·¯ç”±å±¤æ¬Šé™æ§åˆ¶
3. **UI æ¬Šé™æ§åˆ¶** - æŒ‰éˆ•/æ“ä½œçš„æ¢ä»¶é¡¯ç¤º
4. **PermissionDirective** - æ¬Šé™æŒ‡ä»¤

#### 5. ä»»å‹™è©•è«–èˆ‡è¨è«– â­â­â­

**ç¾æ³**ï¼šè³‡æ–™è¡¨å·²è¨­è¨ˆ (`task_comments`)ï¼Œå‰ç«¯æœªå¯¦ç¾

**å¾…å®Œæˆé …ç›®**ï¼š
1. **TaskCommentService** - è©•è«– CRUD
2. **CommentThreadComponent** - è©•è«–åˆ—è¡¨
3. **@æåŠåŠŸèƒ½** - ä½¿ç”¨è€…æåŠ

---

### ğŸŸ¢ ä¸€èˆ¬å„ªå…ˆç´š - é•·æœŸç›®æ¨™ (6+ é€±)

#### 6. å“è³ªé©—æ”¶æ¨¡çµ„ â­â­

**ç¾æ³**ï¼šåƒ…æœ‰è³‡æ–™åº« enum å®šç¾©

**å¾…å»ºç«‹**ï¼š
- æª¢æŸ¥æ¸…å–®ç³»çµ±
- é©—æ”¶æµç¨‹
- é©—æ”¶å ±å‘Š

#### 7. é€šçŸ¥ä¸­å¿ƒ â­â­

**å¾…å»ºç«‹**ï¼š
- é€šçŸ¥è³‡æ–™è¡¨
- å³æ™‚é€šçŸ¥ (Supabase Realtime)
- é€šçŸ¥ UI å…ƒä»¶

#### 8. å ±è¡¨èˆ‡åˆ†æ â­

**å¾…å»ºç«‹**ï¼š
- é€²åº¦å ±è¡¨
- å·¥æ™‚çµ±è¨ˆ
- Dashboard å¼·åŒ–

---

## ğŸ“ å»ºè­°çš„ç›®éŒ„çµæ§‹

### ä»»å‹™æ¨¡çµ„å®Œæ•´çµæ§‹
```
src/app/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ facades/
â”‚   â”‚   â””â”€â”€ task/
â”‚   â”‚       â”œâ”€â”€ task.facade.ts
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â””â”€â”€ infra/
â”‚       â”œâ”€â”€ repositories/
â”‚       â”‚   â””â”€â”€ task/
â”‚       â”‚       â”œâ”€â”€ task.repository.ts
â”‚       â”‚       â””â”€â”€ index.ts
â”‚       â””â”€â”€ types/
â”‚           â””â”€â”€ task/
â”‚               â””â”€â”€ index.ts
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ task/
â”‚   â”‚       â”œâ”€â”€ task.service.ts    â† å·²å­˜åœ¨ï¼Œéœ€ä¿®æ”¹
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ task/
â”‚           â”œâ”€â”€ task.models.ts
â”‚           â””â”€â”€ index.ts
â””â”€â”€ routes/
    â””â”€â”€ blueprint/
        â””â”€â”€ tasks/                  â† å·²å®Œæˆ
            â”œâ”€â”€ task-list/
            â”œâ”€â”€ task-detail/
            â”œâ”€â”€ task-create/
            â””â”€â”€ components/
```

### æ—¥èªŒæ¨¡çµ„çµæ§‹
```
src/app/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ infra/
â”‚       â””â”€â”€ repositories/
â”‚           â””â”€â”€ diary/
â”‚               â”œâ”€â”€ diary.repository.ts
â”‚               â””â”€â”€ index.ts
â”œâ”€â”€ shared/
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ diary/
â”‚           â”œâ”€â”€ diary.service.ts
â”‚           â””â”€â”€ index.ts
â””â”€â”€ routes/
    â””â”€â”€ blueprint/
        â””â”€â”€ diary/
            â”œâ”€â”€ diary-list/
            â”œâ”€â”€ diary-form/
            â”œâ”€â”€ diary-detail/
            â””â”€â”€ components/
```

---

## ğŸ”§ æŠ€è¡“å»ºè­° (Angular 20 ç¾ä»£åŒ–æ¨¡å¼)

> ä»¥ä¸‹æŠ€è¡“å»ºè­°åŸºæ–¼ Angular 20.3.x å®˜æ–¹æ–‡æª”ï¼Œä½¿ç”¨ Context7 é©—è­‰çš„æœ€æ–° API å’Œæœ€ä½³å¯¦è¸ã€‚

### 1. Repository æ¨¡å¼ (ä½¿ç”¨ inject() å‡½æ•¸)

å»ºè­°æ‰€æœ‰è³‡æ–™å­˜å–éƒ½é€šé Repository å±¤ï¼Œä½¿ç”¨ Angular 20 çš„ `inject()` å‡½æ•¸é€²è¡Œä¾è³´æ³¨å…¥ï¼š

```typescript
// src/app/core/infra/repositories/task/task.repository.ts
import { inject, Injectable } from '@angular/core';
import { SupabaseService } from '@core/supabase';
import type { Database } from '@core/supabase/database.types';

type Task = Database['public']['Tables']['tasks']['Row'];
type CreateTaskRequest = Database['public']['Tables']['tasks']['Insert'];

@Injectable({ providedIn: 'root' })
export class TaskRepository {
  // Angular 20 æ¨è–¦ä½¿ç”¨ inject() å‡½æ•¸è€Œéæ§‹é€ å‡½æ•¸æ³¨å…¥
  private readonly supabase = inject(SupabaseService);

  async findByBlueprint(blueprintId: string): Promise<Task[]> {
    const { data, error } = await this.supabase.client
      .from('tasks')
      .select('*')
      .eq('blueprint_id', blueprintId)
      .is('deleted_at', null)
      .order('sort_order');
    
    if (error) throw error;
    return data as Task[];
  }

  async create(request: CreateTaskRequest): Promise<Task> {
    // ä½¿ç”¨ RPC å‡½æ•¸é€²è¡ŒåŸå­æ“ä½œ
    const { data, error } = await this.supabase.client
      .rpc('create_task', { ...request });
    
    if (error) throw error;
    return data;
  }

  async update(id: string, updates: Partial<Task>): Promise<Task> {
    const { data, error } = await this.supabase.client
      .from('tasks')
      .update(updates)
      .eq('id', id)
      .select()
      .single();
    
    if (error) throw error;
    return data;
  }

  async delete(id: string): Promise<void> {
    const { error } = await this.supabase.client
      .from('tasks')
      .update({ deleted_at: new Date().toISOString() })
      .eq('id', id);
    
    if (error) throw error;
  }
}
```

### 2. Signal ç‹€æ…‹ç®¡ç† (Angular 20 Signals + linkedSignal)

ä½¿ç”¨ Angular 20 çš„ `signal()`ã€`computed()` å’Œ `linkedSignal()` é€²è¡ŒéŸ¿æ‡‰å¼ç‹€æ…‹ç®¡ç†ï¼š

```typescript
// src/app/shared/services/task/task.service.ts
import { inject, Injectable, signal, computed, linkedSignal } from '@angular/core';
import { TaskRepository } from '@core/infra/repositories/task';
import type { Task } from '@shared/models/task';

@Injectable({ providedIn: 'root' })
export class TaskService {
  private readonly repo = inject(TaskRepository);
  
  // æ ¸å¿ƒç‹€æ…‹ signals
  private readonly tasksState = signal<Task[]>([]);
  private readonly loadingState = signal<boolean>(false);
  private readonly errorState = signal<string | null>(null);
  
  // Readonly signals ä¾›å¤–éƒ¨æ¶ˆè²»
  readonly tasks = this.tasksState.asReadonly();
  readonly loading = this.loadingState.asReadonly();
  readonly error = this.errorState.asReadonly();
  
  // Computed signals - è‡ªå‹•è¿½è¹¤ä¾è³´ä¸¦æ›´æ–°
  readonly taskTree = computed(() => this.buildTree(this.tasksState()));
  readonly taskCount = computed(() => this.tasksState().length);
  readonly hasError = computed(() => this.errorState() !== null);
  
  // linkedSignal - ç•¶ä¾†æº signal è®ŠåŒ–æ™‚è‡ªå‹•æ›´æ–°é¸ä¸­ç‹€æ…‹
  readonly selectedTask = linkedSignal<Task[], Task | null>({
    source: this.tasksState,
    computation: (tasks, previous) => {
      // ä¿æŒé¸ä¸­ç‹€æ…‹ï¼Œå¦‚æœä»»å‹™é‚„å­˜åœ¨å‰‡ä¿ç•™é¸æ“‡
      if (previous?.value) {
        return tasks.find(t => t.id === previous.value!.id) ?? null;
      }
      return null;
    }
  });

  async loadTasks(blueprintId: string): Promise<void> {
    this.loadingState.set(true);
    this.errorState.set(null);
    
    try {
      const tasks = await this.repo.findByBlueprint(blueprintId);
      this.tasksState.set(tasks);
    } catch (err) {
      this.errorState.set(err instanceof Error ? err.message : 'è¼‰å…¥å¤±æ•—');
    } finally {
      this.loadingState.set(false);
    }
  }

  selectTask(task: Task): void {
    this.selectedTask.set(task);
  }

  private buildTree(tasks: Task[]): Task[] {
    // å»ºç«‹ä»»å‹™æ¨¹ç‹€çµæ§‹
    const taskMap = new Map(tasks.map(t => [t.id, { ...t, children: [] }]));
    const roots: Task[] = [];
    
    for (const task of taskMap.values()) {
      if (task.parent_id && taskMap.has(task.parent_id)) {
        taskMap.get(task.parent_id)!.children.push(task);
      } else {
        roots.push(task);
      }
    }
    
    return roots;
  }
}
```

### 3. RxJS æ•´åˆ (toSignal å’Œ toObservable)

åœ¨éœ€è¦èˆ‡ RxJS Observable äº’æ“ä½œæ™‚ï¼Œä½¿ç”¨ Angular 20 çš„ `toSignal()` å’Œ `toObservable()`ï¼š

```typescript
// å°‡ Observable è½‰æ›ç‚º Signal
import { Component, inject } from '@angular/core';
import { toSignal, toObservable } from '@angular/core/rxjs-interop';
import { interval, switchMap } from 'rxjs';
import { HttpClient } from '@angular/common/http';

@Component({
  selector: 'app-realtime-status',
  standalone: true,
  template: `
    <div>ç‹€æ…‹: {{ status() }}</div>
    <div>æœå°‹çµæœ: {{ searchResults() | json }}</div>
  `
})
export class RealtimeStatusComponent {
  private readonly http = inject(HttpClient);
  
  // Observable â†’ Signal (è‡ªå‹•è¨‚é–±å’Œå–æ¶ˆè¨‚é–±)
  readonly status = toSignal(
    interval(5000).pipe(
      switchMap(() => this.http.get<string>('/api/status'))
    ),
    { initialValue: 'è¼‰å…¥ä¸­...' }
  );

  // æœå°‹åŠŸèƒ½ï¼šSignal â†’ Observable â†’ Signal
  readonly searchQuery = signal('');
  
  readonly searchResults = toSignal(
    toObservable(this.searchQuery).pipe(
      switchMap(query => this.http.get<any[]>(`/api/search?q=${query}`))
    ),
    { initialValue: [] }
  );
}
```

### 4. Supabase TypeScript é¡å‹å®‰å…¨

ä½¿ç”¨ Supabase CLI ç”Ÿæˆ TypeScript é¡å‹ï¼Œç¢ºä¿å®Œæ•´çš„é¡å‹å®‰å…¨ï¼š

```bash
# ç”Ÿæˆé¡å‹å®šç¾©
npx supabase gen types typescript --local > src/app/core/supabase/database.types.ts
```

```typescript
// src/app/core/supabase/supabase.service.ts
import { inject, Injectable } from '@angular/core';
import { createClient, SupabaseClient } from '@supabase/supabase-js';
import { environment } from '@env/environment';
import type { Database } from './database.types';

@Injectable({ providedIn: 'root' })
export class SupabaseService {
  // ä½¿ç”¨æ³›å‹ç¢ºä¿é¡å‹å®‰å…¨
  readonly client: SupabaseClient<Database> = createClient<Database>(
    environment.supabaseUrl,
    environment.supabaseAnonKey
  );

  // é¡å‹å®‰å…¨çš„è¡¨æ ¼å­˜å–
  from<T extends keyof Database['public']['Tables']>(table: T) {
    return this.client.from(table);
  }

  // é¡å‹å®‰å…¨çš„ RPC èª¿ç”¨
  rpc<T extends keyof Database['public']['Functions']>(
    fn: T,
    args: Database['public']['Functions'][T]['Args']
  ) {
    return this.client.rpc(fn, args as any);
  }
}
```

### 5. å…ƒä»¶è¨­è¨ˆæ¨¡å¼ (Angular 20 Standalone)

ä½¿ç”¨ Angular 20 çš„ Standalone Components å’Œç¾ä»£åŒ–æ¨¡å¼ï¼š

```typescript
// src/app/routes/blueprint/tasks/task-list/task-list.component.ts
import { Component, inject, input, output, ChangeDetectionStrategy } from '@angular/core';
import { SHARED_IMPORTS } from '@shared';
import { TaskService } from '@shared/services/task';
import type { Task } from '@shared/models/task';

@Component({
  selector: 'app-task-list',
  standalone: true,
  imports: [SHARED_IMPORTS],
  changeDetection: ChangeDetectionStrategy.OnPush,
  template: `
    @if (taskService.loading()) {
      <nz-spin nzTip="è¼‰å…¥ä¸­..."></nz-spin>
    } @else if (taskService.hasError()) {
      <nz-alert 
        nzType="error" 
        [nzMessage]="taskService.error()"
        nzShowIcon
      ></nz-alert>
    } @else {
      <nz-table
        #basicTable
        [nzData]="taskService.tasks()"
        [nzFrontPagination]="false"
        [nzShowPagination]="true"
        nzSize="middle"
      >
        <thead>
          <tr>
            <th>ä»»å‹™åç¨±</th>
            <th>ç‹€æ…‹</th>
            <th>é€²åº¦</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          @for (task of basicTable.data; track task.id) {
            <tr 
              [class.selected]="taskService.selectedTask()?.id === task.id"
              (click)="taskService.selectTask(task)"
            >
              <td>{{ task.name }}</td>
              <td>
                <nz-tag [nzColor]="getStatusColor(task.status)">
                  {{ task.status }}
                </nz-tag>
              </td>
              <td>
                <nz-progress 
                  [nzPercent]="task.progress" 
                  nzSize="small"
                ></nz-progress>
              </td>
              <td>
                <a (click)="onEdit.emit(task); $event.stopPropagation()">ç·¨è¼¯</a>
                <nz-divider nzType="vertical"></nz-divider>
                <a 
                  nz-popconfirm
                  nzPopconfirmTitle="ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ"
                  (nzOnConfirm)="onDelete.emit(task)"
                  (click)="$event.stopPropagation()"
                >åˆªé™¤</a>
              </td>
            </tr>
          }
        </tbody>
      </nz-table>
    }
  `
})
export class TaskListComponent {
  // Angular 20: ä½¿ç”¨ inject() å‡½æ•¸
  readonly taskService = inject(TaskService);
  
  // Angular 20: ä½¿ç”¨ input() å’Œ output() å‡½æ•¸
  readonly blueprintId = input.required<string>();
  readonly onEdit = output<Task>();
  readonly onDelete = output<Task>();

  getStatusColor(status: string): string {
    const colors: Record<string, string> = {
      'pending': 'default',
      'in_progress': 'processing',
      'completed': 'success',
      'blocked': 'error'
    };
    return colors[status] ?? 'default';
  }
}
```

### 6. éŒ¯èª¤è™•ç†æ¨¡å¼

çµ±ä¸€ä½¿ç”¨å°ˆæ¡ˆçš„éŒ¯èª¤è™•ç†æ¨¡å¼ï¼Œæ­é… Angular 20 çš„ Signalï¼š

```typescript
import { inject, Injectable, signal, computed } from '@angular/core';
import { NzMessageService } from 'ng-zorro-antd/message';

@Injectable({ providedIn: 'root' })
export class TaskService {
  private readonly msg = inject(NzMessageService);
  private readonly repo = inject(TaskRepository);
  
  private readonly errorState = signal<Error | null>(null);
  readonly error = this.errorState.asReadonly();
  readonly hasError = computed(() => this.errorState() !== null);

  async createTask(request: CreateTaskRequest): Promise<Task | null> {
    try {
      const task = await this.repo.create(request);
      this.msg.success('ä»»å‹™å»ºç«‹æˆåŠŸ');
      this.errorState.set(null);
      return task;
    } catch (err) {
      const error = err instanceof Error ? err : new Error('æ“ä½œå¤±æ•—');
      this.errorState.set(error);
      this.msg.error(error.message);
      return null;
    }
  }
}
```

### 7. è¡¨å–®è™•ç† (Reactive Forms + Signal)

çµåˆ Angular Reactive Forms å’Œ Signalsï¼š

```typescript
// src/app/routes/blueprint/tasks/task-form/task-form.component.ts
import { Component, inject, input, output, effect } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
import { SHARED_IMPORTS } from '@shared';

@Component({
  selector: 'app-task-form',
  standalone: true,
  imports: [SHARED_IMPORTS],
  template: `
    <form nz-form [formGroup]="form" (ngSubmit)="onSubmit()">
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzRequired nzFor="name">ä»»å‹™åç¨±</nz-form-label>
        <nz-form-control [nzSpan]="14" nzErrorTip="è«‹è¼¸å…¥ä»»å‹™åç¨±">
          <input nz-input formControlName="name" id="name" />
        </nz-form-control>
      </nz-form-item>
      
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="description">æè¿°</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <textarea nz-input formControlName="description" id="description" rows="4"></textarea>
        </nz-form-control>
      </nz-form-item>
      
      <nz-form-item>
        <nz-form-control [nzSpan]="14" [nzOffset]="6">
          <button nz-button nzType="primary" [disabled]="!form.valid">
            {{ editMode() ? 'æ›´æ–°' : 'å»ºç«‹' }}
          </button>
        </nz-form-control>
      </nz-form-item>
    </form>
  `
})
export class TaskFormComponent {
  private readonly fb = inject(FormBuilder);
  
  // ä½¿ç”¨ input signal æ¥æ”¶ç·¨è¼¯è³‡æ–™
  readonly task = input<Task | null>(null);
  readonly onSave = output<CreateTaskRequest>();
  
  readonly editMode = computed(() => this.task() !== null);
  
  readonly form = this.fb.group({
    name: ['', [Validators.required, Validators.minLength(2)]],
    description: [''],
    parent_id: [null as string | null],
    priority: ['medium' as 'low' | 'medium' | 'high']
  });

  constructor() {
    // ä½¿ç”¨ effect ç›£è½ task è®ŠåŒ–ä¸¦æ›´æ–°è¡¨å–®
    effect(() => {
      const task = this.task();
      if (task) {
        this.form.patchValue({
          name: task.name,
          description: task.description ?? '',
          parent_id: task.parent_id,
          priority: task.priority
        });
      } else {
        this.form.reset({ priority: 'medium' });
      }
    });
  }

  onSubmit(): void {
    if (this.form.valid) {
      this.onSave.emit(this.form.value as CreateTaskRequest);
    }
  }
}
```

---

## ğŸ“ ç«‹å³è¡Œå‹•æ¸…å–®

### æœ¬é€± (Week 1) - åŸºç¤è¨­æ–½å»ºç«‹

- [ ] **ç”Ÿæˆ Supabase TypeScript é¡å‹**
  ```bash
  npx supabase gen types typescript --local > src/app/core/supabase/database.types.ts
  ```
- [ ] å»ºç«‹ `TaskRepository` è³‡æ–™å­˜å–å±¤ï¼ˆä½¿ç”¨ `inject()` å‡½æ•¸ï¼‰
- [ ] å¯¦ç¾ä»»å‹™ CRUD çš„çœŸå¯¦è³‡æ–™åº«æ“ä½œï¼ˆå®Œæ•´é¡å‹å®‰å…¨ï¼‰
- [ ] ç§»é™¤ `TaskService` ä¸­çš„ mock è³‡æ–™
- [ ] ä½¿ç”¨ `signal()` å’Œ `computed()` é‡æ§‹ç‹€æ…‹ç®¡ç†

### ä¸‹é€± (Week 2) - é€²éšåŠŸèƒ½æ•´åˆ

- [ ] å¯¦ç¾ `linkedSignal` ç®¡ç†ä»»å‹™é¸æ“‡ç‹€æ…‹
- [ ] å¯¦ç¾ä»»å‹™æŒ‡æ´¾åŠŸèƒ½ï¼ˆä½¿ç”¨ `task_assignees` è³‡æ–™è¡¨ï¼‰
- [ ] å¯¦ç¾çˆ¶ä»»å‹™é€²åº¦è‡ªå‹•è¨ˆç®—ï¼ˆä½¿ç”¨ `computed()` signalsï¼‰
- [ ] ä½¿ç”¨ `effect()` è™•ç†å‰¯ä½œç”¨ï¼ˆå¦‚ï¼šé€šçŸ¥ã€æ—¥èªŒï¼‰
- [ ] æ¸¬è©¦å®Œæ•´çš„ä»»å‹™ç®¡ç†æµç¨‹

### ç¬¬ä¸‰é€± (Week 3) - æ—¥èªŒæ¨¡çµ„é–‹ç™¼

- [ ] å»ºç«‹ `DiaryRepository` è³‡æ–™å­˜å–å±¤
- [ ] å®Œæˆæ—¥èªŒè¡¨å–® UIï¼ˆä½¿ç”¨ Reactive Forms + Signalï¼‰
- [ ] æ•´åˆ Supabase Storage é€²è¡Œç…§ç‰‡ä¸Šå‚³
- [ ] å¯¦ç¾æ—¥èªŒæ¢ç›®ç®¡ç†
- [ ] ä½¿ç”¨ `toSignal()` æ•´åˆ Supabase Realtime è¨‚é–±

---

## ğŸ”„ ç‰ˆæœ¬å‡ç´šå»ºè­°

### ç•¶å‰ç‰ˆæœ¬ç‹€æ…‹

| å¥—ä»¶ | ç•¶å‰ç‰ˆæœ¬ | æœ€æ–°ç‰ˆæœ¬ | å»ºè­° |
|------|---------|---------|------|
| @angular/core | 20.3.0 | 20.3.x | âœ… å·²æ˜¯æœ€æ–° |
| @delon/abc | 20.1.0 | 20.1.x | âœ… å·²æ˜¯æœ€æ–° |
| ng-zorro-antd | 20.4.3 | 20.4.x | âœ… å·²æ˜¯æœ€æ–° |
| @supabase/supabase-js | 2.86.0 | 2.x | âœ… å·²æ˜¯æœ€æ–° |
| TypeScript | 5.9.2 | 5.9.x | âœ… å·²æ˜¯æœ€æ–° |

### Angular 20 æ–°ç‰¹æ€§ä½¿ç”¨

æœ¬å°ˆæ¡ˆæ‡‰å……åˆ†åˆ©ç”¨ Angular 20 çš„æ–°ç‰¹æ€§ï¼š

1. **`signal()`, `computed()`, `effect()`** - éŸ¿æ‡‰å¼ç‹€æ…‹ç®¡ç†
2. **`linkedSignal()`** - ä¾è³´ç‹€æ…‹åŒæ­¥
3. **`inject()` å‡½æ•¸** - ç¾ä»£åŒ–ä¾è³´æ³¨å…¥
4. **`input()`, `output()` å‡½æ•¸** - å…ƒä»¶é€šè¨Š
5. **`@if`, `@for`, `@switch`** - æ§åˆ¶æµèªæ³•
6. **`toSignal()`, `toObservable()`** - RxJS äº’æ“ä½œ

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [ç³»çµ±æ¶æ§‹](GigHub_Architecture.md)
- [åŠŸèƒ½æ–‡ä»¶](features/README.md)
- [ç”¢å“éœ€æ±‚](prd/construction-site-management.md)
- [Supabase Schema](../seed.sql)
- [Angular å®˜æ–¹æ–‡æª”](https://angular.dev)
- [ng-alain æ–‡æª”](https://ng-alain.com)
- [ng-zorro-antd æ–‡æª”](https://ng.ant.design)
- [Supabase æ–‡æª”](https://supabase.com/docs)

---

## ğŸ¯ ç¸½çµ

åŸºæ–¼å°ˆæ¡ˆåˆ†æå’Œ Angular 20 æœ€ä½³å¯¦è¸ï¼Œ**å»ºè­°çš„é–‹ç™¼é †åº**ç‚ºï¼š

1. **ğŸ“Œ åŸºç¤è¨­æ–½ç¾ä»£åŒ–**
   - ç”Ÿæˆ Supabase TypeScript é¡å‹
   - å»ºç«‹é¡å‹å®‰å…¨çš„ Repository å±¤
   - æ¡ç”¨ Angular 20 Signal æ¨¡å¼

2. **ğŸ“Œ ä»»å‹™æ¨¡çµ„å®Œå–„** - æœ€é«˜å„ªå…ˆï¼Œå·²æœ‰ UI åªéœ€å®Œæˆå¾Œç«¯

3. **ğŸ“Œ æ–½å·¥æ—¥èªŒæ¨¡çµ„** - æ ¸å¿ƒæ¥­å‹™éœ€æ±‚

4. **ğŸ“Œ æª”æ¡ˆç®¡ç†æ¨¡çµ„** - æ”¯æ´æ—¥èªŒå’Œä»»å‹™é™„ä»¶

5. **æ¬Šé™æ§åˆ¶å®Œå–„** - æå‡å®‰å…¨æ€§

6. **å…¶ä»–æ¨¡çµ„** - æŒ‰éœ€é–‹ç™¼

### æœ€é‡è¦çš„ä¸‹ä¸€æ­¥

1. åŸ·è¡Œ `npx supabase gen types typescript --local > src/app/core/supabase/database.types.ts` ç”Ÿæˆé¡å‹
2. å®Œæˆ `TaskRepository`ï¼ˆä½¿ç”¨ `inject()` å‡½æ•¸å’Œå®Œæ•´é¡å‹ï¼‰
3. é‡æ§‹ `TaskService`ï¼ˆä½¿ç”¨ `signal()`, `computed()`, `linkedSignal()`ï¼‰
4. ç§»é™¤ mock è³‡æ–™ï¼Œé€£æ¥çœŸå¯¦è³‡æ–™åº«

---

**æœ€å¾Œæ›´æ–°**: 2025-12-02
**æŠ€è¡“åƒè€ƒ**: Angular 20.3 å®˜æ–¹æ–‡æª” (via Context7)
