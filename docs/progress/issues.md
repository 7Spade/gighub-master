# ⚠️ 已知問題清單

> 最後更新: 2025-12-04  
> 總計問題數量: 25 項

---

## 📊 問題總覽

| 嚴重程度   | 數量 | 說明                 |
| ---------- | ---- | -------------------- |
| 🔴 P0 阻塞 | 4    | 阻塞核心功能，必須立即修復 |
| 🟠 P1 關鍵 | 5    | 影響核心功能，需儘快修復 |
| 🟡 P2 重要 | 6    | 影響用戶體驗，需排程修復 |
| 🟢 P3 輕微 | 5    | 可延後修復           |
| 🔧 技術債  | 5    | 需要重構             |

---

## 🔴 P0 - 阻塞性問題 (必須立即修復)

### ISSUE-001: 藍圖編輯功能完全缺失

| 屬性     | 內容                                                    |
| -------- | ------------------------------------------------------- |
| 問題描述 | 藍圖建立後無法編輯，編輯按鈕顯示「編輯功能開發中」訊息 |
| 影響範圍 | 所有藍圖用戶                                            |
| 業務影響 | 無法修正錯誤資訊、無法更新設定、無法啟用/停用模組      |
| 相關檔案 | `src/app/routes/blueprint/overview/overview.component.ts` |
| 狀態     | 🔴 待處理                                               |
| 負責人   | -                                                       |
| 預計工時 | 11h                                                     |

**重現步驟**:
1. 建立一個藍圖
2. 進入藍圖概覽頁面
3. 點擊「編輯」按鈕
4. 顯示「編輯功能開發中」訊息

**建議修復**:
- [ ] 實現藍圖編輯抽屜組件
- [ ] 實現藍圖基本資訊編輯 API
- [ ] 實現模組啟用/停用功能
- [ ] 實現藍圖狀態變更功能
- [ ] 實現藍圖封面上傳功能

---

### ISSUE-002: 藍圖概覽頁面資訊架構問題

| 屬性     | 內容                                                              |
| -------- | ----------------------------------------------------------------- |
| 問題描述 | 財務資訊（總預算、已支出、已付款、剩餘預算）顯示在概覽頁面頂部    |
| 影響範圍 | 權限規劃、資訊架構                                                |
| 業務影響 | 無法針對財務資訊單獨設定存取權限，權限規劃困難                    |
| 相關檔案 | `src/app/routes/blueprint/overview/overview.component.ts`         |
| 狀態     | 🔴 待處理                                                         |
| 負責人   | -                                                                 |
| 預計工時 | 7h                                                                |

**問題詳情**:
```html
<!-- 目前財務統計卡片在概覽頁面 -->
<nz-card>
  <div class="stat-card">總預算: {{ totalBudget }}</div>
  <div class="stat-card">已支出: {{ totalExpense }}</div>
  ...
</nz-card>
```

**建議修復**:
- [ ] 將財務統計卡片移至「財務」Tab
- [ ] 概覽頁面保留基本藍圖資訊
- [ ] 調整權限系統以支援財務模組權限

---

### ISSUE-003: 藍圖概覽未達生產標準

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 藍圖概覽頁面多項功能使用佔位符或假資料      |
| 影響範圍 | 所有藍圖用戶                                |
| 業務影響 | 用戶體驗不佳、功能不完整、無法正式上線      |
| 相關檔案 | `src/app/routes/blueprint/overview/overview.component.ts` |
| 狀態     | 🔴 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 16h                                         |

**具體問題**:
- 活動時間軸顯示「暫無活動記錄」佔位符
- 部分統計資料使用假資料
- 財務資訊與概覽資訊混合
- 成員資訊顯示 `account_id` 而非名稱

**建議修復**:
- [ ] 整合時間軸服務到活動 Tab
- [ ] 確保所有統計資料來自真實數據
- [ ] 重新設計資訊架構
- [ ] 修正成員顯示邏輯

---

### ISSUE-004: 任務管理使用 Mock 資料後備

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 真實資料載入失敗時，任務管理使用 Mock 資料   |
| 影響範圍 | 任務管理模組                                |
| 業務影響 | 開發環境與生產環境行為不一致、測試困難      |
| 相關檔案 | `src/app/routes/blueprint/tasks/tasks.component.ts` |
| 狀態     | 🔴 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 4h                                          |

**問題程式碼**:
```typescript
async loadTasks(): Promise<void> {
  try {
    await this.taskService.loadTasksByBlueprint(this.id());
  } catch {
    // If no real data, load mock data for development
    this.taskService.loadMockData(this.id());  // ❌ 應移除
  }
}
```

**建議修復**:
- [ ] 移除 Mock 資料後備機制
- [ ] 添加適當的錯誤處理 UI
- [ ] 添加重試機制
- [ ] 添加空狀態 UI

---

## 🟠 P1 - 關鍵問題 (需儘快修復)

### ISSUE-005: 權限系統未完全實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 權限系統基礎已完成，但部分功能尚未實現      |
| 影響範圍 | 所有需要權限控制的功能                      |
| 業務影響 | 無法精細控制權限、效能可能受影響            |
| 相關檔案 | `src/app/shared/services/permission/permission.service.ts` |
| 狀態     | 🟠 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 26h                                         |

**缺失功能**:
- [ ] 權限快取策略
- [ ] 動態權限計算 (基於多角色)
- [ ] 資源級別權限檢查
- [ ] 權限管理 UI
- [ ] 自訂角色建立/編輯

---

### ISSUE-006: 搜尋功能未完全整合

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 搜尋服務已實現，但未完全整合到 UI           |
| 影響範圍 | 搜尋功能用戶                                |
| 業務影響 | 用戶無法有效搜尋內容                        |
| 相關檔案 | `src/app/shared/services/search/search.service.ts` |
| 狀態     | 🟠 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 28h                                         |

**缺失功能**:
- [ ] 全域搜尋面板
- [ ] 關聯搜尋
- [ ] 權限感知過濾
- [ ] 進階搜尋 UI

---

### ISSUE-007: 通知系統未完全實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 通知服務已實現，但 UI 和進階功能未完成      |
| 影響範圍 | 通知功能用戶                                |
| 業務影響 | 用戶無法接收和管理通知                      |
| 相關檔案 | `src/app/shared/services/notification/notification.service.ts` |
| 狀態     | 🟠 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 32h                                         |

**缺失功能**:
- [ ] 通知中心 UI
- [ ] 排程通知
- [ ] 多頻道路由
- [ ] 訂閱管理 UI
- [ ] 智慧合併
- [ ] 勿擾模式

---

### ISSUE-008: 時間軸 UI 未實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 時間軸服務已實現，但 UI 組件未完成          |
| 影響範圍 | 藍圖概覽、活動歷史                          |
| 業務影響 | 用戶無法查看活動歷史和審計軌跡              |
| 相關檔案 | `src/app/shared/services/timeline/timeline.service.ts` |
| 狀態     | 🟠 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 30h                                         |

**缺失功能**:
- [ ] 跨模組活動追蹤 UI
- [ ] 完整操作歷史視圖
- [ ] 版本控制 (diff 視圖)
- [ ] 審計軌跡
- [ ] 多時間軸視圖

---

### ISSUE-009: 日誌管理 UI 未實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 日誌服務已實現，但前端 UI 未完成            |
| 影響範圍 | 日誌管理功能                                |
| 業務影響 | 用戶無法建立和管理施工日誌                  |
| 相關檔案 | `src/app/shared/services/diary/diary.service.ts` |
| 狀態     | 🟠 待處理                                   |
| 負責人   | -                                           |
| 預計工時 | 28h                                         |

**缺失功能**:
- [ ] 日誌建立/編輯 UI
- [ ] 日誌列表頁面
- [ ] 日誌詳情頁面
- [ ] 日誌附件上傳
- [ ] 日誌模板功能
- [ ] 日誌審核流程

---

## 🟡 P2 - 重要問題 (需排程修復)

### ISSUE-010: 品質驗收 UI 未實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | QC 和驗收服務已實現，但前端 UI 未完成       |
| 影響範圍 | 品質驗收功能                                |
| 業務影響 | 用戶無法進行品質驗收操作                    |
| 狀態     | 🟡 待處理                                   |
| 預計工時 | 30h                                         |

---

### ISSUE-011: 檔案管理 UI 未實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 檔案服務已實現，但前端 UI 未完成            |
| 影響範圍 | 檔案管理功能                                |
| 業務影響 | 用戶無法上傳和管理檔案                      |
| 狀態     | 🟡 待處理                                   |
| 預計工時 | 32h                                         |

---

### ISSUE-012: 關聯管理未完善

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 關聯管理基礎已完成，但進階功能未實現        |
| 影響範圍 | 任務、日誌、檔案關聯                        |
| 業務影響 | 無法建立完整的資料關聯                      |
| 狀態     | 🟡 待處理                                   |
| 預計工時 | 30h                                         |

**缺失功能**:
- [ ] 任務 ↔ 任務 父子關聯
- [ ] 任務 ↔ 檔案 關聯
- [ ] 任務 ↔ 日誌 關聯
- [ ] 級聯刪除處理
- [ ] 循環參照檢測
- [ ] 關聯視覺化 UI

---

### ISSUE-013: 配置中心未實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 配置中心完全未實現                          |
| 影響範圍 | 藍圖自訂化設定                              |
| 業務影響 | 無法自訂藍圖配置                            |
| 狀態     | 🟡 待處理                                   |
| 預計工時 | 30h                                         |

---

### ISSUE-014: 元數據系統未實現

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 元數據系統完全未實現                        |
| 影響範圍 | 自訂欄位、分類系統                          |
| 業務影響 | 無法自訂資料欄位                            |
| 狀態     | 🟡 待處理                                   |
| 預計工時 | 28h                                         |

---

### ISSUE-015: API 閘道未完善

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | API 閘道基礎已完成，但進階功能未實現        |
| 影響範圍 | API 管理、外部整合                          |
| 業務影響 | 無法進行 API 速率限制和外部整合             |
| 狀態     | 🟡 待處理                                   |
| 預計工時 | 32h                                         |

---

## 🟢 P3 - 輕微問題 (可延後修復)

### ISSUE-016: 成員資訊顯示 account_id 而非名稱

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 成員列表顯示 `account_id` 而非用戶名稱      |
| 影響範圍 | 成員列表顯示                                |
| 業務影響 | 用戶體驗不佳                                |
| 相關檔案 | `src/app/routes/blueprint/overview/overview.component.ts` |
| 狀態     | 🟢 待處理                                   |
| 預計工時 | 2h                                          |

**問題程式碼**:
```html
<span>{{ member.account_id }}</span>  <!-- 應顯示 member.display_name -->
```

---

### ISSUE-017: 日期格式不一致

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 部分頁面使用 `toLocaleDateString`，部分使用 Angular DatePipe |
| 影響範圍 | 日期顯示                                    |
| 業務影響 | 用戶介面不一致                              |
| 狀態     | 🟢 待處理                                   |
| 預計工時 | 2h                                          |

**建議修復**:
- 統一使用 Angular DatePipe
- 定義標準日期格式

---

### ISSUE-018: 錯誤處理訊息中英混用

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 部分錯誤訊息使用中文，部分使用英文          |
| 影響範圍 | 錯誤訊息顯示                                |
| 業務影響 | 用戶介面不一致                              |
| 狀態     | 🟢 待處理                                   |
| 預計工時 | 4h                                          |

**建議修復**:
- 將所有錯誤訊息整合到 i18n
- 統一語言

---

### ISSUE-019: 空狀態 UI 不一致

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 各頁面空狀態顯示不一致                      |
| 影響範圍 | 列表頁面                                    |
| 業務影響 | 用戶體驗不一致                              |
| 狀態     | 🟢 待處理                                   |
| 預計工時 | 4h                                          |

---

### ISSUE-020: Loading 狀態不一致

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 各頁面 Loading 狀態顯示不一致               |
| 影響範圍 | 資料載入                                    |
| 業務影響 | 用戶體驗不一致                              |
| 狀態     | 🟢 待處理                                   |
| 預計工時 | 4h                                          |

---

## 🔧 技術債務 (需要重構)

### TD-001: 大型組件檔案需要拆分

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 部分組件檔案過大，超過專案規範              |
| 影響範圍 | 程式碼維護性                                |
| 業務影響 | 開發效率降低                                |
| 狀態     | 🔧 待處理                                   |
| 預計工時 | 16h                                         |

**需要拆分的檔案**:
| 檔案 | 行數 | 建議 |
| ---- | ---- | ---- |
| `src/app/routes/blueprint/tasks/tasks.component.ts` | 681 行 | 拆分為子組件 |
| `src/app/routes/blueprint/overview/overview.component.ts` | 859 行 | 拆分為子組件 |
| `src/app/shared/services/search/search.service.ts` | 600 行 | 拆分為多個服務 |

---

### TD-002: 服務間依賴複雜

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 部分服務之間存在複雜的依賴關係              |
| 影響範圍 | 程式碼維護性                                |
| 業務影響 | 測試和維護困難                              |
| 狀態     | 🔧 待處理                                   |
| 預計工時 | 8h                                          |

---

### TD-003: 缺乏單元測試覆蓋

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 目前專案缺乏足夠的單元測試覆蓋              |
| 影響範圍 | 程式碼品質                                  |
| 業務影響 | 回歸風險高                                  |
| 狀態     | 🔧 待處理                                   |
| 預計工時 | 54h                                         |

**目標覆蓋率**:
| 類型 | 目標 | 當前 |
| ---- | ---- | ---- |
| Store | 100% | ~0% |
| Service | 80%+ | ~10% |
| Component | 60%+ | ~5% |
| Utils | 100% | ~20% |

---

### TD-004: TypeScript Strict Mode 警告

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 部分程式碼存在 TypeScript strict mode 警告  |
| 影響範圍 | 型別安全                                    |
| 業務影響 | 潛在運行時錯誤                              |
| 狀態     | 🔧 待處理                                   |
| 預計工時 | 6h                                          |

---

### TD-005: 重複程式碼

| 屬性     | 內容                                        |
| -------- | ------------------------------------------- |
| 問題描述 | 部分程式碼存在重複，需要提取為共用元件/服務 |
| 影響範圍 | 程式碼維護性                                |
| 業務影響 | 維護成本增加                                |
| 狀態     | 🔧 待處理                                   |
| 預計工時 | 8h                                          |

---

## 📝 問題追蹤表

| 問題編號   | 嚴重程度 | 狀態   | 負責人 | 預計完成日期 | 預計工時 |
| ---------- | -------- | ------ | ------ | ------------ | -------- |
| ISSUE-001  | 🔴 P0    | 待處理 | -      | -            | 11h      |
| ISSUE-002  | 🔴 P0    | 待處理 | -      | -            | 7h       |
| ISSUE-003  | 🔴 P0    | 待處理 | -      | -            | 16h      |
| ISSUE-004  | 🔴 P0    | 待處理 | -      | -            | 4h       |
| ISSUE-005  | 🟠 P1    | 待處理 | -      | -            | 26h      |
| ISSUE-006  | 🟠 P1    | 待處理 | -      | -            | 28h      |
| ISSUE-007  | 🟠 P1    | 待處理 | -      | -            | 32h      |
| ISSUE-008  | 🟠 P1    | 待處理 | -      | -            | 30h      |
| ISSUE-009  | 🟠 P1    | 待處理 | -      | -            | 28h      |
| ISSUE-010  | 🟡 P2    | 待處理 | -      | -            | 30h      |
| ISSUE-011  | 🟡 P2    | 待處理 | -      | -            | 32h      |
| ISSUE-012  | 🟡 P2    | 待處理 | -      | -            | 30h      |
| ISSUE-013  | 🟡 P2    | 待處理 | -      | -            | 30h      |
| ISSUE-014  | 🟡 P2    | 待處理 | -      | -            | 28h      |
| ISSUE-015  | 🟡 P2    | 待處理 | -      | -            | 32h      |
| ISSUE-016  | 🟢 P3    | 待處理 | -      | -            | 2h       |
| ISSUE-017  | 🟢 P3    | 待處理 | -      | -            | 2h       |
| ISSUE-018  | 🟢 P3    | 待處理 | -      | -            | 4h       |
| ISSUE-019  | 🟢 P3    | 待處理 | -      | -            | 4h       |
| ISSUE-020  | 🟢 P3    | 待處理 | -      | -            | 4h       |
| TD-001     | 🔧 TD    | 待處理 | -      | -            | 16h      |
| TD-002     | 🔧 TD    | 待處理 | -      | -            | 8h       |
| TD-003     | 🔧 TD    | 待處理 | -      | -            | 54h      |
| TD-004     | 🔧 TD    | 待處理 | -      | -            | 6h       |
| TD-005     | 🔧 TD    | 待處理 | -      | -            | 8h       |

---

## 📊 工時統計

| 嚴重程度   | 問題數 | 總預計工時 |
| ---------- | ------ | ---------- |
| 🔴 P0 阻塞 | 4      | 38h        |
| 🟠 P1 關鍵 | 5      | 144h       |
| 🟡 P2 重要 | 6      | 182h       |
| 🟢 P3 輕微 | 5      | 16h        |
| 🔧 技術債  | 5      | 92h        |
| **總計**   | **25** | **472h**   |

---

## 🎯 修復優先順序建議

### Sprint 1 (Week 1-2): P0 阻塞問題
1. ISSUE-001: 藍圖編輯功能
2. ISSUE-002: 概覽頁面資訊架構
3. ISSUE-004: Mock 資料移除

### Sprint 2 (Week 3-4): P1 關鍵問題 (1/2)
4. ISSUE-008: 時間軸 UI
5. ISSUE-007: 通知中心 UI

### Sprint 3 (Week 5-6): P1 關鍵問題 (2/2)
6. ISSUE-006: 搜尋功能整合
7. ISSUE-009: 日誌管理 UI

### Sprint 4 (Week 7-8): P2 重要問題 (1/2)
8. ISSUE-010: 品質驗收 UI
9. ISSUE-011: 檔案管理 UI

### Sprint 5+ (Week 9+): 剩餘問題
10. 其他 P2 問題
11. P3 輕微問題
12. 技術債務

---

**最後更新**: 2025-12-04
