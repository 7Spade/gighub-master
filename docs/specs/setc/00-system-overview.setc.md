# 00-system-overview.setc.md

## 1. 模組概述

### 業務價值
GigHub 是一套工地施工進度追蹤管理系統，專為建築工程專案管理而設計。系統提供：
- **即時進度追蹤**：掌握工程各階段施工狀態
- **品質驗收管理**：確保施工品質符合規範
- **團隊協作平台**：促進工地人員溝通協調
- **數據分析報表**：提供決策支援依據

### 核心功能
1. **帳戶與組織管理**：支援個人、組織、Bot 三種帳戶類型
2. **藍圖系統**：作為邏輯容器提供資料隔離的工作空間
3. **任務系統**：樹狀結構的工項管理（系統主核心）
4. **施工日誌**：每日施工記錄與照片管理
5. **品質驗收**：檢查清單與驗收流程
6. **問題追蹤**：缺陷開立與處理流程

### 在系統中的定位
本文件為 SETC 系列的總綱文件，定義系統整體架構與模組關係，為所有開發人員提供全局視角。

---

## 2. 功能需求

### 系統架構三層模型

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        基礎層 (Foundation Layer)                         │
│                                                                          │
│   涉及：用戶身份、組織、Bot、認證                                           │
│   資料表：accounts, organizations, organization_members, teams           │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        容器層 (Container Layer)                          │
│                                                                          │
│   涉及：藍圖、工作區、分支、權限                                            │
│   資料表：blueprints, blueprint_members, blueprint_roles                 │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        業務層 (Business Layer)                           │
│                                                                          │
│   模組：任務管理、施工日誌、品質驗收、問題追蹤                                │
│   資料表：tasks, diaries, checklists, issues, files, notifications       │
└─────────────────────────────────────────────────────────────────────────┘
```

### 使用者故事總覽

| 類別 | 故事數量 | ID 範圍 | 優先級 |
|------|----------|---------|--------|
| 帳戶與認證 | 4 | GH-001 ~ GH-004 | 🔴 P0 |
| 組織與團隊 | 4 | GH-005 ~ GH-008 | 🔴 P0 |
| 藍圖管理 | 4 | GH-009 ~ GH-012 | 🔴 P0 |
| 任務管理 | 5 | GH-013 ~ GH-017 | 🔴 P0 |
| 施工日誌 | 4 | GH-018 ~ GH-021 | 🔴 P0 |
| 品質驗收 | 4 | GH-022 ~ GH-025 | 🟡 P1 |
| 問題追蹤 | 3 | GH-026 ~ GH-028 | 🟡 P1 |
| 協作溝通 | 3 | GH-029 ~ GH-031 | 🟡 P1 |
| 報表分析 | 3 | GH-032 ~ GH-034 | 🟡 P1 |
| 離線與同步 | 3 | GH-035 ~ GH-037 | 🟢 P2 |
| 系統管理 | 3 | GH-038 ~ GH-040 | 🟢 P2 |

**總計**：40 個使用者故事

### 驗收標準
- [ ] 所有三層架構明確劃分
- [ ] 角色與權限體系完整定義
- [ ] 模組間依賴關係清楚

---

## 3. 技術設計

### 技術棧

| 類別 | 技術 | 版本 | 說明 |
|------|------|------|------|
| 前端框架 | Angular | 20.3.x | Standalone Components |
| UI 框架 | ng-alain | 20.1.x | 企業級 Admin 框架 |
| UI 元件庫 | ng-zorro-antd | 20.3.x | Ant Design for Angular |
| 狀態管理 | Angular Signals | 內建 | 反應式狀態管理 |
| 後端服務 | Supabase | 2.84.x | BaaS 平台 |
| 資料庫 | PostgreSQL | 15.x | 關聯式資料庫 |
| 認證 | Supabase Auth | - | 身份認證 |
| 樣式 | LESS | - | CSS 預處理器 |

### API 設計原則
- 採用 Supabase 自動生成的 REST API
- 使用 RLS (Row Level Security) 進行資料存取控制
- 前端透過 Repository 模式封裝 Supabase 呼叫

### 前端元件結構

```
src/app/
├── core/                   # 【基礎層】核心基礎設施
│   ├── facades/           # Facade 模式統一 API
│   ├── guards/            # 路由守衛
│   ├── interceptors/      # HTTP 攔截器
│   └── services/          # 全域服務
│
├── shared/                 # 【共享資源】跨模組共享
│   ├── components/        # 共用元件
│   ├── directives/        # 共用指令
│   ├── pipes/             # 共用管道
│   └── services/          # 共用服務
│
├── layout/                 # 【版面配置】版面元件
│
├── routes/                 # 【路由頁面】路由頁面
│
└── features/               # 【容器層 + 業務模組層】功能模組
    └── blueprint/         # 藍圖功能模組（垂直切片）
        ├── shell/         # 邏輯容器層
        ├── domain/        # 領域層
        ├── data-access/   # 資料存取層
        └── ui/            # 展示層
```

### 狀態管理
使用 Angular Signals 進行狀態管理：
- `signal()` - 基本反應式狀態
- `computed()` - 衍生狀態
- `effect()` - 副作用處理

---

## 4. 安全與權限

### 角色體系

#### 平台層級角色

| 角色 | 說明 | 權限範圍 |
|------|------|----------|
| 超級管理員 | 系統全域最高權限 | 所有功能 |
| 組織擁有者 | 組織最高權限者 | 組織內所有功能 |
| 組織管理員 | 組織管理者 | 組織成員與設定管理 |
| 一般用戶 | 個人層級使用者 | 個人資源存取 |

#### 藍圖層級角色

| 角色 | 說明 | 權限範圍 |
|------|------|----------|
| 專案經理 | 藍圖規劃與管理者 | 完整讀寫 |
| 工地主任 | 工地現場最高負責人 | 任務與驗收管理 |
| 施工人員 | 實際執行施工任務者 | 任務執行與回報 |
| 品管人員 | 負責品質檢查者 | 驗收操作 |
| 觀察者 | 唯讀權限使用者 | 僅讀取 |

### RLS 政策設計原則
1. 每張表必須有 RLS 政策
2. 使用 Helper Functions 封裝權限檢查
3. 避免在 RLS 中直接查詢受保護的表（防止遞迴）

---

## 5. 測試規範

### 覆蓋率目標

| 層級 | 目標 | 測試重點 |
|------|------|----------|
| Store 層 | 100% | 狀態變更、computed signals |
| Service 層 | 80%+ | API 呼叫、錯誤處理 |
| Component 層 | 60%+ | 關鍵交互、表單提交 |
| Utils | 100% | 純函數、邊界條件 |

### 測試命名規範
```typescript
// 格式：MethodName_Condition_ExpectedResult
it('loadTasks_whenBlueprintIdValid_shouldReturnTasks', () => { ... });
it('updateStatus_whenNoPermission_shouldThrowError', () => { ... });
```

---

## 6. 效能考量

### 前端效能目標

| 指標 | 目標值 |
|------|--------|
| 首次內容繪製 (FCP) | < 1.5s |
| 最大內容繪製 (LCP) | < 2.5s |
| 互動至下一次繪製 (INP) | < 200ms |
| 累積佈局偏移 (CLS) | < 0.1 |
| 任務樹渲染 (1000 節點) | < 500ms |

### 後端效能目標

| 指標 | 目標值 |
|------|--------|
| API 回應時間 (P50) | < 200ms |
| API 回應時間 (P95) | < 500ms |
| API 回應時間 (P99) | < 1s |
| 資料庫查詢 (P95) | < 100ms |

### 優化策略
- 使用虛擬捲動處理大量資料
- 實作資料快取策略 (Stale-While-Revalidate)
- 使用 OnPush 變更檢測策略

---

## 7. 實作檢查清單

### 階段 0：全域理解（必讀）
- [ ] 了解三層架構設計
- [ ] 熟悉角色與權限體系
- [ ] 理解模組間依賴關係

### 階段 1：基礎建設（P0 - 第 0~2 週）
- [ ] 基礎層帳戶體系建立
- [ ] 容器層藍圖系統實作
- [ ] 資料庫 Schema 完成
- [ ] RLS 政策設定

### 階段 2：核心業務（P1 - 第 3~5 週）
- [ ] 任務系統開發
- [ ] 測試策略落實

### 階段 3：協作功能（P2 - 第 6~9 週）
- [ ] 施工日誌模組
- [ ] 待辦模組
- [ ] 檔案模組
- [ ] Realtime 功能

### 階段 4：增強功能（P3 - 第 10~13 週）
- [ ] 連結模組
- [ ] 儀表板模組
- [ ] 模組整合
- [ ] 部署與維運

---

## 附錄 A：開發理念（KEEP.md 核心原則）

### 奧卡姆剃刀原則 (Occam's Razor Principle)
- **保持簡單**：避免不必要的複雜度
- **功能最小化**：只做必要功能，避免功能膨脹
- **易於擴展**：模組可靈活擴展與延伸，但不預先實現
- **避免冗餘**：消除重複功能與資料以降低維護成本

### 企業標準 (Enterprise Standard)
- 雖然簡潔但符合企業級品質要求
- 適合生產環境的企業級標準與可運維性
- 遵循企業級規範和最佳實務

### 零認知開發 (Zero Cognitive Development)
- 降低開發者認知負擔
- 簡化使用介面與 API
- 程式碼應自我解釋，減少閱讀負擔

### 架構核心概念
- **藍圖是邏輯容器**：藍圖負責承載業務邏輯與邊界，提供資料隔離的工作空間
- **任務是主核心模組**：任務模組為系統主要功能單元，其他模組應以任務為依賴中心
- **上下文層層傳遞**：上下文訊息以明確界面逐層傳遞，避免跨層依賴

---

## 附錄 B：SETC 文件索引

| # | 文件名稱 | 說明 | 優先級 |
|---|----------|------|--------|
| 00 | system-overview | 系統架構總覽 | P0 (必讀) |
| 01 | foundation-layer | 基礎層：帳戶+組織+權限 | P0 |
| 02 | blueprint-container | 容器層：藍圖系統核心 | P0 |
| 03 | container-infrastructure | 容器層：12項基礎設施 | P0 |
| 04 | angular-project-structure | Angular 專案結構對應 | P0 |
| 05 | task-module | 工項模組（含驗收機制） | P1 |
| 06 | diary-module | 日誌模組 | P2 |
| 07 | todo-module | 待辦模組（五態分類） | P2 |
| 08 | file-module | 檔案模組 | P2 |
| 09 | link-module | 連結模組 | P3 |
| 10 | dashboard-module | 儀表板模組 | P3 |
| 11 | module-integration | 模組整合與關聯 | P2 |

> **注意**：資料庫設計、安全權限、即時同步、測試策略、效能監控、部署維運等詳細技術規格，
> 請參考 `docs/architecture/` 與 `docs/specs/` 中的專門文件。本 SETC 系列聚焦於模組級規範。

---

**文件版本**: v1.1
**最後更新**: 2025-11-28
**維護者**: 專案架構師
