# ğŸ”§ Supabase æ•´åˆ

> **ç›®çš„**: æä¾› Supabase æœå‹™æ•´åˆçš„å®Œæ•´æŒ‡å—

---

## ğŸ“‘ Supabase æ–‡æª”ç´¢å¼•

| æ–‡æª” | èªªæ˜ | é€£çµ |
|------|------|------|
| **é·ç§»çµæ§‹æŒ‡å—** | çµæ§‹åŒ–é·ç§»å‘½åèˆ‡è¨­è¨ˆåŸå‰‡ | [migrations/STRUCTURED_MIGRATION_GUIDE.md](./migrations/STRUCTURED_MIGRATION_GUIDE.md) |
| **é·ç§»çµæ§‹æ¨¹** | è¦–è¦ºåŒ–é·ç§»çµæ§‹é€ŸæŸ¥è¡¨ | [migrations/MIGRATION_STRUCTURE_TREE.md](./migrations/MIGRATION_STRUCTURE_TREE.md) |
| Schema è¨­è¨ˆ | è³‡æ–™è¡¨çµæ§‹èˆ‡å‘½åè¦ç¯„ | [schema/README.md](./schema/README.md) |
| RLS æ”¿ç­–è¨­è¨ˆ | Row Level Security ç­–ç•¥ | [rls/README.md](./rls/README.md) |
| å‡½æ•¸è¨­è¨ˆ | è³‡æ–™åº«å‡½æ•¸èˆ‡è§¸ç™¼å™¨ | [functions/README.md](./functions/README.md) |
| é·ç§»æ–‡æª” | é·ç§»æµç¨‹èˆ‡æœ€ä½³å¯¦è¸ | [migrations/README.md](./migrations/README.md) |

---

## ğŸ—ï¸ æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Angular å‰ç«¯                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Repository å±¤ â†’ @supabase/supabase-js                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Supabase æœå‹™                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Auth       â”‚ â”‚   Database   â”‚ â”‚   Storage    â”‚ â”‚   Realtime   â”‚   â”‚
â”‚  â”‚   èªè­‰æœå‹™    â”‚ â”‚   PostgreSQL â”‚ â”‚   æª”æ¡ˆå­˜å„²    â”‚ â”‚   å³æ™‚è¨‚é–±    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Edge Functions                               â”‚   â”‚
â”‚  â”‚                      é‚Šç·£å‡½æ•¸ï¼ˆè¤‡é›œæ¥­å‹™é‚è¼¯ï¼‰                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ RLS æ”¿ç­–æ¦‚è¦½

### æ—¢æœ‰æ”¿ç­– âœ…

| æ”¿ç­– | è¡¨ | æ“ä½œ |
|------|-----|------|
| `users_view_own_user_account` | accounts | SELECT |
| `users_update_own_user_account` | accounts | UPDATE |
| `org_owners_update_organizations` | accounts | UPDATE |
| `users_view_teams_in_their_organizations` | teams | SELECT |
| ... | ... | ... |

### è¨­è¨ˆåŸå‰‡

1. **é¿å…ç„¡é™éè¿´**: ä½¿ç”¨ `SECURITY DEFINER` + `row_security = off`
2. **ä½¿ç”¨ Helper Function**: å°è£è¤‡é›œé‚è¼¯
3. **æœ€å°æ¬Šé™åŸå‰‡**: åªæˆäºˆå¿…è¦æ¬Šé™

---

## ğŸ“Š è§¸ç™¼å™¨æ¸…å–®

### æ—¢æœ‰è§¸ç™¼å™¨ âœ…

| è§¸ç™¼å™¨ | è¡¨ | äº‹ä»¶ | ç”¨é€” |
|--------|-----|------|------|
| `add_creator_as_org_owner` | accounts | AFTER INSERT | çµ„ç¹”å»ºç«‹è€…è‡ªå‹•æˆç‚º owner |
| `add_team_creator_as_leader_trigger` | teams | AFTER INSERT | åœ˜éšŠå»ºç«‹è€…è‡ªå‹•æˆç‚º leader |

---

## ğŸ› ï¸ æœ¬åœ°é–‹ç™¼

### å•Ÿå‹•æœ¬åœ° Supabase

```bash
pnpm supabase:start
```

### é‡ç½®è³‡æ–™åº«

```bash
pnpm supabase:reset
```

### ç”Ÿæˆé¡å‹

```bash
pnpm supabase:gen-types
```

### å»ºç«‹ Migration

```bash
pnpm supabase migration new <migration_name>
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [çµæ§‹åŒ–é·ç§»æŒ‡å—](./migrations/STRUCTURED_MIGRATION_GUIDE.md) â­ **æ–°å¢**
- [é·ç§»çµæ§‹æ¨¹é€ŸæŸ¥è¡¨](./migrations/MIGRATION_STRUCTURE_TREE.md) â­ **æ–°å¢**
- [æŠ€è¡“è¦ç¯„](../specs/README.md)
- [è³‡æ–™æ¨¡å‹](../reference/data-model.md)
- [PRD æ–‡ä»¶](../prd/construction-site-management.md)

---

**æœ€å¾Œæ›´æ–°**: 2025-12-03  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ
