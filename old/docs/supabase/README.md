# ğŸ”§ Supabase æ•´åˆ

> **ç›®çš„**: æä¾› Supabase æœå‹™æ•´åˆçš„å®Œæ•´æŒ‡å—

---

## ğŸ“‘ Supabase ç´¢å¼•

| æ–‡æª” | èªªæ˜ | é€£çµ |
|------|------|------|
| RLS ç­–ç•¥ | Row Level Security ç­–ç•¥ | [rls-policies.md](./rls-policies.md) |
| è³‡æ–™åº«è¨­è¨ˆ | PostgreSQL è³‡æ–™åº«è¨­è¨ˆ | [database-design.md](./database-design.md) |
| Edge Functions | é‚Šç·£å‡½æ•¸æŒ‡å— | [edge-functions.md](./edge-functions.md) |
| Realtime | å³æ™‚è¨‚é–±æŒ‡å— | [realtime.md](./realtime.md) |
| Storage | æª”æ¡ˆå­˜å„²æŒ‡å— | [storage.md](./storage.md) |

---

## ğŸ—ï¸ æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Angular å‰ç«¯                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Repository å±¤ â†’ @supabase/supabase-js                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Supabase æœå‹™                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Auth       â”‚ â”‚   Database   â”‚ â”‚   Storage    â”‚ â”‚   Realtime   â”‚   â”‚
â”‚  â”‚   èªè­‰æœå‹™    â”‚ â”‚   PostgreSQL â”‚ â”‚   æª”æ¡ˆå­˜å„²    â”‚ â”‚   å³æ™‚è¨‚é–±    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Edge Functions                               â”‚   â”‚
â”‚  â”‚                      é‚Šç·£å‡½æ•¸ï¼ˆè¤‡é›œæ¥­å‹™é‚è¼¯ï¼‰                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ RLS æ”¿ç­–æ¦‚è¦½

### æ—¢æœ‰æ”¿ç­– âœ…

| æ”¿ç­– | è¡¨ | æ“ä½œ |
|------|-----|------|
| `users_view_own_user_account` | accounts | SELECT |
| `users_update_own_user_account` | accounts | UPDATE |
| `org_owners_update_organizations` | accounts | UPDATE |
| `users_view_teams_in_their_organizations` | teams | SELECT |
| ... | ... | ... |

### è¨­è¨ˆåŸå‰‡

1. **é¿å…ç„¡é™éè¿´**: ä½¿ç”¨ `SECURITY DEFINER` + `row_security = off`
2. **ä½¿ç”¨ Helper Function**: å°è£è¤‡é›œé‚è¼¯
3. **æœ€å°æ¬Šé™åŸå‰‡**: åªæˆäºˆå¿…è¦æ¬Šé™

---

## ğŸ“Š è§¸ç™¼å™¨æ¸…å–®

### æ—¢æœ‰è§¸ç™¼å™¨ âœ…

| è§¸ç™¼å™¨ | è¡¨ | äº‹ä»¶ | ç”¨é€” |
|--------|-----|------|------|
| `add_creator_as_org_owner` | accounts | AFTER INSERT | çµ„ç¹”å»ºç«‹è€…è‡ªå‹•æˆç‚º owner |
| `add_team_creator_as_leader_trigger` | teams | AFTER INSERT | åœ˜éšŠå»ºç«‹è€…è‡ªå‹•æˆç‚º leader |

---

## ğŸ› ï¸ æœ¬åœ°é–‹ç™¼

### å•Ÿå‹•æœ¬åœ° Supabase

```bash
pnpm supabase:start
```

### é‡ç½®è³‡æ–™åº«

```bash
pnpm supabase:reset
```

### ç”Ÿæˆé¡å‹

```bash
pnpm supabase:gen-types
```

### å»ºç«‹ Migration

```bash
pnpm supabase migration new <migration_name>
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [æŠ€è¡“è¦ç¯„](../specs/README.md)
- [è³‡æ–™æ¨¡å‹](../reference/data-model.md)
- [PRD æ–‡ä»¶](../prd/construction-site-management.md)

---

**æœ€å¾Œæ›´æ–°**: 2025-11-27  
**ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ
