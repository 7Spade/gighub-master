<!-- 組織監控儀表板 -->
<div class="monitor-dashboard">
  <!-- 頂部標題區 -->
  <div class="monitor-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="monitor-title">
          <i nz-icon nzType="monitor" nzTheme="outline"></i>
          組織監控中心
        </h1>
        <p class="monitor-subtitle">實時追蹤組織運營數據與關鍵指標</p>
      </div>
      <div class="header-right">
        <nz-tag nzColor="success" class="status-tag">
          <i nz-icon nzType="check-circle" nzTheme="fill"></i>
          系統運行正常
        </nz-tag>
        <span class="update-time">最後更新：{{ activeStat.t2 }}</span>
      </div>
    </div>
  </div>

  <div nz-row [nzGutter]="[24, 24]">
    <!-- 左側主內容區 -->
    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="18">
      <nz-card [nzBordered]="false" class="monitor-card main-card">
        <div class="card-header">
          <div class="card-title">
            <i nz-icon nzType="dashboard" nzTheme="outline" class="title-icon"></i>
            運營活動總覽
          </div>
        </div>
        
        <!-- 關鍵指標 -->
        <div nz-row [nzGutter]="[24, 24]" class="kpi-row">
          <div nz-col nzXs="24" nzSm="12" nzMd="6">
            <div class="kpi-card">
              <div class="kpi-icon primary">
                <i nz-icon nzType="stock" nzTheme="outline"></i>
              </div>
              <div class="kpi-content">
                <span class="kpi-label">{{ 'app.monitor.total-transactions' | i18n }}</span>
                <div class="kpi-value">2,345</div>
                <span class="kpi-unit">立方米</span>
              </div>
            </div>
          </div>
          <div nz-col nzXs="24" nzSm="12" nzMd="6">
            <div class="kpi-card">
              <div class="kpi-icon success">
                <i nz-icon nzType="aim" nzTheme="outline"></i>
              </div>
              <div class="kpi-content">
                <span class="kpi-label">{{ 'app.monitor.sales-target' | i18n }}</span>
                <div class="kpi-value">78%</div>
                <span class="kpi-unit">達成率</span>
              </div>
            </div>
          </div>
          <div nz-col nzXs="24" nzSm="12" nzMd="6">
            <div class="kpi-card">
              <div class="kpi-icon warning">
                <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
              </div>
              <div class="kpi-content">
                <span class="kpi-label">{{ 'app.monitor.remaining-time' | i18n }}</span>
                <div class="kpi-value countdown">
                  <count-down [config]="cd" />
                </div>
              </div>
            </div>
          </div>
          <div nz-col nzXs="24" nzSm="12" nzMd="6">
            <div class="kpi-card">
              <div class="kpi-icon info">
                <i nz-icon nzType="team" nzTheme="outline"></i>
              </div>
              <div class="kpi-content">
                <span class="kpi-label">{{ 'app.monitor.total-transactions-per-second' | i18n }}</span>
                <div class="kpi-value">156</div>
                <span class="kpi-unit">人次</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 地圖區域 -->
        <div class="map-section">
          <div class="map-overlay">
            <img
              nz-tooltip
              [nzTooltipTitle]="'app.monitor.waiting-for-implementation' | i18n"
              nzTooltipPlacement="top"
              src="https://gw.alipayobjects.com/zos/rmsportal/HBWnDEUXCnGnGrRfrpKa.png"
              alt="site-layout"
            />
          </div>
        </div>
      </nz-card>
    </div>
    
    <!-- 右側側邊欄 -->
    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="6">
      <!-- 活動預測 -->
      <nz-card [nzBordered]="false" class="monitor-card sidebar-card">
        <div class="card-header">
          <div class="card-title">
            <i nz-icon nzType="fund-projection-screen" nzTheme="outline" class="title-icon"></i>
            {{ 'app.monitor.activity-forecast' | i18n }}
          </div>
        </div>
        @if (activeData) {
          <div class="forecast-content">
            <div class="forecast-stat">
              <span class="forecast-label">進度預測</span>
              <span class="forecast-value">按計劃推進</span>
            </div>
            <div class="forecast-chart">
              <g2-mini-area [animate]="false" line [borderWidth]="2" [height]="100" [padding]="0" [data]="activeData" />
            </div>
            <div class="forecast-legend">
              <div class="legend-item">
                <span class="legend-dot max"></span>
                <span class="legend-label">最高</span>
                <span class="legend-value">{{ activeStat.max }}%</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot min"></span>
                <span class="legend-label">平均</span>
                <span class="legend-value">{{ activeStat.min }}%</span>
              </div>
            </div>
          </div>
        }
      </nz-card>
      
      <!-- 效率儀表 -->
      <nz-card [nzBordered]="false" class="monitor-card sidebar-card">
        <div class="card-header">
          <div class="card-title">
            <i nz-icon nzType="dashboard" nzTheme="outline" class="title-icon"></i>
            {{ 'app.monitor.efficiency' | i18n }}
          </div>
        </div>
        @if (percent) {
          <div class="gauge-container">
            <g2-gauge [title]="'app.monitor.ratio' | i18n" [height]="180" [percent]="percent" [format]="couponFormat" />
          </div>
        }
      </nz-card>
    </div>
  </div>

  <!-- 底部圖表區 -->
  <div nz-row [nzGutter]="[24, 24]" class="bottom-row">
    <div nz-col nzXs="24" nzSm="24" nzLg="12">
      <nz-card [nzBordered]="false" class="monitor-card">
        <div class="card-header">
          <div class="card-title">
            <i nz-icon nzType="pie-chart" nzTheme="outline" class="title-icon"></i>
            {{ 'app.monitor.proportion-per-category' | i18n }}
          </div>
        </div>
        <div nz-row [nzGutter]="[16, 16]" class="pie-grid">
          <div nz-col [nzSpan]="8">
            <div class="pie-item">
              <g2-pie [animate]="false" [percent]="35" [subTitle]="'app.monitor.fast-food' | i18n" total="35%" [height]="128" [lineWidth]="2" />
              <div class="pie-label">土建工程</div>
            </div>
          </div>
          <div nz-col [nzSpan]="8">
            <div class="pie-item">
              <g2-pie
                [animate]="false"
                color="#5DDECF"
                [percent]="28"
                [subTitle]="'app.monitor.western-food' | i18n"
                total="28%"
                [height]="128"
                [lineWidth]="2"
              />
              <div class="pie-label">機電安裝</div>
            </div>
          </div>
          <div nz-col [nzSpan]="8">
            <div class="pie-item">
              <g2-pie
                [animate]="false"
                color="#2FC25B"
                [percent]="37"
                [subTitle]="'app.monitor.hot-pot' | i18n"
                total="37%"
                [height]="128"
                [lineWidth]="2"
              />
              <div class="pie-label">裝飾裝修</div>
            </div>
          </div>
        </div>
      </nz-card>
    </div>
    <div nz-col nzXs="24" nzSm="24" nzLg="6">
      <nz-card [nzBordered]="false" class="monitor-card">
        <div class="card-header">
          <div class="card-title">
            <i nz-icon nzType="cloud" nzTheme="outline" class="title-icon"></i>
            {{ 'app.monitor.popular-searches' | i18n }}
          </div>
        </div>
        <div class="tag-cloud-container">
          <g2-tag-cloud [data]="tags" [height]="180" />
        </div>
      </nz-card>
    </div>
    <div nz-col nzXs="24" nzSm="24" nzLg="6">
      <nz-card [nzBordered]="false" class="monitor-card">
        <div class="card-header">
          <div class="card-title">
            <i nz-icon nzType="database" nzTheme="outline" class="title-icon"></i>
            {{ 'app.monitor.resource-surplus' | i18n }}
          </div>
        </div>
        <div class="water-wave-container">
          <g2-water-wave [title]="'app.monitor.fund-surplus' | i18n" [percent]="68" [height]="180" />
        </div>
      </nz-card>
    </div>
  </div>
</div>
