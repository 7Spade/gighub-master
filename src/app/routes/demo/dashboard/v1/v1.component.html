<!-- 個人/團隊儀表板 -->
<div class="dashboard-header">
  <div class="welcome-section">
    <div class="welcome-content">
      <h1 class="welcome-title">
        <span class="greeting">早安！</span>
        <span class="highlight">今天也要加油 💪</span>
      </h1>
      <p class="welcome-subtitle">工地施工進度 · 項目管理總覽</p>
    </div>
    <div class="header-actions">
      <button nz-button nzType="primary" nzSize="large">
        <i nz-icon nzType="plus" nzTheme="outline"></i>
        新增任務
      </button>
    </div>
  </div>
</div>

<quick-menu>
  <nz-list [nzBordered]="false" [nzSplit]="false">
    <nz-list-item>
      <a routerLink="/">首頁</a>
    </nz-list-item>
    <nz-list-item>
      <a routerLink="/widgets">小部件</a>
    </nz-list-item>
    <nz-list-item>
      <a routerLink="/style/typography">排版</a>
    </nz-list-item>
    <nz-list-item>
      <a routerLink="/style/gridmasonry">瀑布流</a>
    </nz-list-item>
    <nz-list-item>
      <a routerLink="/pro/result/success">成功頁</a>
    </nz-list-item>
  </nz-list>
</quick-menu>

<!-- 統計卡片區 -->
<div nz-row [nzGutter]="[16, 16]" class="stat-row">
  <div nz-col nzXs="24" nzSm="12" nzMd="6">
    <div class="modern-stat-card gradient-primary">
      <div class="stat-bg-icon">
        <i nz-icon nzType="team" nzTheme="outline"></i>
      </div>
      <div class="stat-body">
        <div class="stat-value-lg">156</div>
        <div class="stat-label">今日作業人數</div>
      </div>
      <div class="stat-chart">
        @if (webSite) {
          <g2-mini-bar
            height="40"
            color="rgba(255,255,255,0.65)"
            borderWidth="2"
            [padding]="[8, 16]"
            [data]="webSite"
            tooltipType="mini"
            (ready)="fixDark($event)"
          />
        }
      </div>
    </div>
  </div>
  <div nz-col nzXs="24" nzSm="12" nzMd="6">
    <div class="modern-stat-card gradient-success">
      <div class="stat-bg-icon">
        <i nz-icon nzType="check-circle" nzTheme="outline"></i>
      </div>
      <div class="stat-body">
        <div class="stat-value-lg">78%</div>
        <div class="stat-label">整體完成進度</div>
      </div>
      <div class="stat-chart">
        @if (webSite) {
          <g2-mini-bar
            height="40"
            color="rgba(255,255,255,0.65)"
            borderWidth="2"
            [padding]="[8, 16]"
            [data]="webSite"
            tooltipType="mini"
            (ready)="fixDark($event)"
          />
        }
      </div>
    </div>
  </div>
  <div nz-col nzXs="24" nzSm="12" nzMd="6">
    <div class="modern-stat-card gradient-warning">
      <div class="stat-bg-icon">
        <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
      </div>
      <div class="stat-body">
        <div class="stat-value-lg">23</div>
        <div class="stat-label">進行中任務</div>
      </div>
      <div class="stat-chart">
        @if (webSite) {
          <g2-mini-bar
            height="40"
            color="rgba(255,255,255,0.65)"
            borderWidth="2"
            [padding]="[8, 16]"
            [data]="webSite"
            tooltipType="mini"
            (ready)="fixDark($event)"
          />
        }
      </div>
    </div>
  </div>
  <div nz-col nzXs="24" nzSm="12" nzMd="6">
    <div class="modern-stat-card gradient-danger">
      <div class="stat-bg-icon">
        <i nz-icon nzType="warning" nzTheme="outline"></i>
      </div>
      <div class="stat-body">
        <div class="stat-value-lg">5</div>
        <div class="stat-label">待處理問題</div>
      </div>
      <div class="stat-chart">
        @if (webSite) {
          <g2-mini-bar
            height="40"
            color="rgba(255,255,255,0.65)"
            borderWidth="2"
            [padding]="[8, 16]"
            [data]="webSite"
            tooltipType="mini"
            (ready)="fixDark($event)"
          />
        }
      </div>
    </div>
  </div>
</div>

<!-- 圖表區 -->
<div nz-row [nzGutter]="[16, 16]" class="chart-row">
  <div nz-col nzXs="24" nzMd="12">
    <nz-card [nzBordered]="false" class="modern-card">
      <div class="card-header">
        <div class="card-title">
          <i nz-icon nzType="bar-chart" nzTheme="outline" class="title-icon"></i>
          施工進度統計
        </div>
        <span class="card-subtitle">各月份施工完成度分析</span>
      </div>
      @if (salesData) {
        <g2-bar height="280" [data]="salesData" />
      }
    </nz-card>
  </div>
  <div nz-col nzXs="24" nzMd="12">
    <nz-card [nzBordered]="false" class="modern-card">
      <div class="card-header">
        <div class="card-title">
          <i nz-icon nzType="line-chart" nzTheme="outline" class="title-icon"></i>
          施工趨勢
        </div>
        <span class="card-subtitle">作業人數與任務完成對比</span>
      </div>
      @if (offlineChartData) {
        <g2-timeline [data]="offlineChartData" [height]="294" [titleMap]="{ y1: '作業人數', y2: '完成任務' }" />
      }
    </nz-card>
  </div>
</div>

<!-- 底部區塊 -->
<div nz-row [nzGutter]="[16, 16]">
  <div nz-col nzXs="24" nzMd="12">
    <nz-card [nzBordered]="false" class="modern-card feature-card">
      <div class="feature-content">
        <div class="feature-icon">
          <i nz-icon nzType="project" nzTheme="outline"></i>
        </div>
        <div class="feature-text">
          <h3>GigHub 工地管理系統</h3>
          <p class="feature-desc">智能化施工進度追蹤</p>
          <ul class="feature-list">
            <li>
              <i nz-icon nzType="check" nzTheme="outline"></i>
              實時監控工地施工進度和作業人員狀態
            </li>
            <li>
              <i nz-icon nzType="check" nzTheme="outline"></i>
              智能分析施工效率，優化資源配置
            </li>
            <li>
              <i nz-icon nzType="check" nzTheme="outline"></i>
              多維度數據展示，助力項目決策
            </li>
          </ul>
          <a nz-button nzType="link" class="feature-link">
            查看更多
            <i nz-icon nzType="arrow-right" nzTheme="outline"></i>
          </a>
        </div>
      </div>
    </nz-card>
  </div>
  <div nz-col nzXs="24" nzMd="12">
    <nz-card [nzBordered]="false" class="modern-card">
      <div class="card-header">
        <div class="card-title">
          <i nz-icon nzType="file-text" nzTheme="outline" class="title-icon"></i>
          施工日誌
        </div>
        <span class="card-subtitle">今日施工記錄匯總</span>
      </div>
      <div class="log-list">
        @for (item of todoData; track $index) {
          <div class="log-item" [class.completed]="item.completed">
            <nz-avatar [nzSrc]="'./assets/tmp/img/' + item.avatar + '.png'" nzSize="small" />
            <div class="log-content">
              <strong>{{ item.name }}</strong>
              <p>{{ item.content }}</p>
            </div>
            <nz-tag [nzColor]="item.completed ? 'success' : 'processing'">
              {{ item.completed ? '已完成' : '進行中' }}
            </nz-tag>
          </div>
        }
      </div>
    </nz-card>
  </div>
  <div nz-col nzXs="24" nzMd="12">
    <nz-card [nzBordered]="false" class="modern-card">
      <div class="card-header">
        <div class="card-title">
          <i nz-icon nzType="unordered-list" nzTheme="outline" class="title-icon"></i>
          待辦事項
        </div>
        <span class="card-subtitle">任務清單管理</span>
      </div>
      <div class="todo-list">
        @for (item of todoData; track $index) {
          <div class="todo-item" [class.completed]="item.completed">
            <div class="todo-checkbox">
              <label nz-checkbox [(ngModel)]="item.completed"></label>
            </div>
            <div class="todo-content">
              <strong>{{ item.name }}</strong>
              <p [class.text-deleted]="item.completed">{{ item.content }}</p>
            </div>
            <div class="todo-actions">
              <i nz-dropdown [nzDropdownMenu]="todoMenus" nzPlacement="topRight" nz-icon nzType="more" class="action-icon"></i>
              <nz-dropdown-menu #todoMenus="nzDropdownMenu">
                <ul nz-menu>
                  @if (item.completed) {
                    <li nz-menu-item (click)="item.completed = false">
                      <i nz-icon nzType="undo" nzTheme="outline"></i>
                      標記進行中
                    </li>
                  } @else {
                    <li nz-menu-item (click)="item.completed = true">
                      <i nz-icon nzType="check" nzTheme="outline"></i>
                      標記完成
                    </li>
                  }
                  <li nz-menu-item nzDanger (click)="todoData.splice(todoData.indexOf(item), 1)">
                    <i nz-icon nzType="delete" nzTheme="outline"></i>
                    刪除
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </div>
        }
      </div>
    </nz-card>
  </div>
</div>
