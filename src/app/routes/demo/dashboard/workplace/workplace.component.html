<!-- 藍圖工作台儀表板 -->
<div class="workplace-dashboard">
  <!-- 頂部歡迎區 -->
  <div class="welcome-banner">
    <div class="banner-content">
      <div class="user-info">
        <nz-avatar [nzSize]="80" nzSrc="https://gw.alipayobjects.com/zos/rmsportal/lctvVCLfRpYCkYxAsiVQ.png" class="user-avatar" />
        <div class="user-detail">
          <h1 class="greeting">早安，項目經理！</h1>
          <p class="role-info">高級工程師 | GigHub工程公司 — 華東區項目部 — 第一施工隊</p>
          <p class="status-info">
            <nz-tag nzColor="success">
              <i nz-icon nzType="check-circle" nzTheme="fill"></i>
              工地施工正常進行中
            </nz-tag>
          </p>
        </div>
      </div>
      <div class="quick-stats">
        <div class="stat-item">
          <div class="stat-value">8</div>
          <div class="stat-label">進行中工區</div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
          <div class="stat-value">78<span class="unit">%</span></div>
          <div class="stat-label">工期進度</div>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
          <div class="stat-value">156</div>
          <div class="stat-label">今日作業人數</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div nz-row [nzGutter]="[24, 24]" class="main-content">
  <!-- 左側主內容 -->
  <div nz-col nzXs="24" nzSm="24" nzMd="16">
    <!-- 進行中的施工項目 -->
    <nz-card [nzBordered]="false" [nzLoading]="loading" class="modern-card project-card">
      <div class="card-header-flex">
        <div class="card-title">
          <i nz-icon nzType="project" nzTheme="outline" class="title-icon"></i>
          進行中的施工項目
        </div>
        <a class="view-all" (click)="msg.success('to')">
          查看全部
          <i nz-icon nzType="arrow-right" nzTheme="outline"></i>
        </a>
      </div>
      
      <div class="project-grid">
        @for (item of notice; track $index) {
          <div class="project-item" (click)="msg.info('to' + item.href)">
            <div class="project-header">
              <nz-avatar [nzSrc]="item.logo" [nzSize]="40" class="project-logo" />
              <div class="project-info">
                <h4 class="project-name">{{ item.title }}</h4>
                <p class="project-desc">{{ item.description }}</p>
              </div>
            </div>
            <div class="project-footer">
              <span class="project-member" (click)="$event.stopPropagation(); msg.info('show user: ' + item.member)">
                <i nz-icon nzType="user" nzTheme="outline"></i>
                {{ item.member }}
              </span>
              @if (item.updatedAt) {
                <span class="project-time">
                  <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
                  {{ item.updatedAt | _date: 'fn' }}
                </span>
              }
            </div>
          </div>
        }
      </div>
    </nz-card>

    <!-- 施工動態 -->
    <nz-card [nzBordered]="false" [nzLoading]="loading" class="modern-card activities-card">
      <div class="card-header-flex">
        <div class="card-title">
          <i nz-icon nzType="history" nzTheme="outline" class="title-icon"></i>
          施工動態
        </div>
      </div>
      
      <nz-timeline>
        @for (item of activities; track $index) {
          <nz-timeline-item [nzColor]="$index === 0 ? 'blue' : 'gray'">
            <div class="activity-item">
              <nz-avatar [nzSrc]="item.user.avatar" nzSize="small" class="activity-avatar" />
              <div class="activity-content">
                <span class="activity-user" (click)="msg.success(item.user.name)">{{ item.user.name }}</span>
                <span class="activity-action" [innerHTML]="item.template"></span>
                <span class="activity-time">{{ item.updatedAt | _date: 'fn' }}</span>
              </div>
            </div>
          </nz-timeline-item>
        }
      </nz-timeline>
    </nz-card>
  </div>

  <!-- 右側邊欄 -->
  <div nz-col nzXs="24" nzSm="24" nzMd="8">
    <!-- 快速入口 -->
    <nz-card [nzBordered]="false" class="modern-card quick-access-card">
      <div class="card-header-flex">
        <div class="card-title">
          <i nz-icon nzType="appstore" nzTheme="outline" class="title-icon"></i>
          快速入口
        </div>
      </div>
      
      <div class="quick-links">
        @for (item of links; track $index) {
          <a class="quick-link" (click)="msg.success(item.title)">
            <div class="link-icon" [ngStyle]="{'background': getIconBg($index)}">
              <i nz-icon [nzType]="getLinkIcon($index)" nzTheme="outline"></i>
            </div>
            <span class="link-text">{{ item.title }}</span>
          </a>
        }
        <button class="quick-link add-btn" (click)="links.push({ title: '新功能', href: 'href' })">
          <div class="link-icon add-icon">
            <i nz-icon nzType="plus" nzTheme="outline"></i>
          </div>
          <span class="link-text">添加</span>
        </button>
      </div>
    </nz-card>

    <!-- 施工效率指數 -->
    <nz-card [nzBordered]="false" [nzLoading]="loading" class="modern-card radar-card">
      <div class="card-header-flex">
        <div class="card-title">
          <i nz-icon nzType="radar-chart" nzTheme="outline" class="title-icon"></i>
          施工效率指數
        </div>
      </div>
      @if (radarData) {
        <g2-radar [data]="radarData" [height]="320" [hasLegend]="true" />
      }
    </nz-card>

    <!-- 施工班組 -->
    <nz-card [nzBordered]="false" class="modern-card team-card">
      <div class="card-header-flex">
        <div class="card-title">
          <i nz-icon nzType="team" nzTheme="outline" class="title-icon"></i>
          施工班組
        </div>
      </div>
      
      <div class="team-list">
        @for (i of members; track $index) {
          <a class="team-item" (click)="msg.success(i.title)">
            <nz-avatar [nzSrc]="i.logo" nzSize="small" class="team-avatar" />
            <span class="team-name">{{ i.title }}</span>
            <i nz-icon nzType="right" nzTheme="outline" class="team-arrow"></i>
          </a>
        }
      </div>
    </nz-card>
  </div>
</div>
