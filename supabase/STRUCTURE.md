# Supabase è³‡æ–™åº«é·ç§»çµæ§‹è¦åŠƒ

## ğŸ“‹ ç›®éŒ„

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [å®Œæ•´çµæ§‹æ¨¹](#å®Œæ•´çµæ§‹æ¨¹)
3. [é·ç§»å‘½åè¦ç¯„](#é·ç§»å‘½åè¦ç¯„)
4. [åŸ·è¡Œé †åº](#åŸ·è¡Œé †åº)
5. [æ¨¡çµ„åˆ†é¡](#æ¨¡çµ„åˆ†é¡)
6. [Seeds çµæ§‹](#seeds-çµæ§‹)
7. [é–‹ç™¼æŒ‡å—](#é–‹ç™¼æŒ‡å—)

---

## æ¦‚è¿°

GigHub å·¥åœ°æ–½å·¥é€²åº¦è¿½è¹¤ç®¡ç†ç³»çµ±çš„ Supabase è³‡æ–™åº«æ¡ç”¨æ¨¡çµ„åŒ–é·ç§»æ¶æ§‹ï¼Œæ”¯æ´ï¼š
- å¤šç§Ÿæˆ¶ SaaS æ¶æ§‹
- è§’è‰²åŸºç¤å­˜å–æ§åˆ¶ (RBAC)
- ä¼æ¥­ç´šå¯©è¨ˆè¿½è¹¤
- å“è³ªç®¡æ§èˆ‡é©—æ”¶æµç¨‹

---

## å®Œæ•´çµæ§‹æ¨¹

```
supabase/
â”œâ”€â”€ config.toml                          # Supabase é…ç½®æ–‡ä»¶
â”œâ”€â”€ MIGRATION_GUIDE.md                   # é·ç§»æŒ‡å—
â”œâ”€â”€ STRUCTURE.md                         # çµæ§‹èªªæ˜æ–‡ä»¶ (æœ¬æ–‡ä»¶)
â”‚
â”œâ”€â”€ migrations/                          # é·ç§»æ–‡ä»¶ç›®éŒ„ (æŒ‰æ™‚é–“æˆ³æ’åº)
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 1: åŸºç¤è¨­æ–½ (Foundation)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00001_extensions.sql             # PostgreSQL æ“´å±•
â”‚   â”‚   â””â”€â”€ å…§å®¹: uuid-ossp, pg_trgm, pgroonga ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 00002_enums_core.sql             # æ ¸å¿ƒåˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: account_type, account_status, organization_role ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 00003_schema_private.sql         # ç§æœ‰ Schema
â”‚   â”‚   â””â”€â”€ å…§å®¹: private schema for RLS helpers
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 2: æ ¸å¿ƒè³‡æ–™è¡¨ (Core Tables)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00100_accounts.sql               # å¸³è™Ÿè¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: auth.users
â”‚   â”‚
â”‚   â”œâ”€â”€ 00101_organizations.sql          # çµ„ç¹”è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00102_organization_members.sql   # çµ„ç¹”æˆå“¡è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: organizations, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00103_teams.sql                  # åœ˜éšŠè¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: organizations
â”‚   â”‚
â”‚   â”œâ”€â”€ 00104_team_members.sql           # åœ˜éšŠæˆå“¡è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: teams, accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 3: è—åœ–æ¨¡çµ„ (Blueprint Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00200_blueprints.sql             # è—åœ–è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: organizations
â”‚   â”‚
â”‚   â”œâ”€â”€ 00201_blueprint_members.sql      # è—åœ–æˆå“¡è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00202_blueprint_teams.sql        # è—åœ–åœ˜éšŠè¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, teams
â”‚   â”‚
â”‚   â”œâ”€â”€ 00203_blueprint_roles.sql        # è—åœ–è§’è‰²è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 00204_blueprint_configs.sql      # è—åœ–é…ç½®è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 4: ä»»å‹™æ¨¡çµ„ (Task Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00300_tasks.sql                  # ä»»å‹™è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00301_task_assignments.sql       # ä»»å‹™æŒ‡æ´¾è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: tasks, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00302_task_comments.sql          # ä»»å‹™è©•è«–è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: tasks, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00303_task_attachments.sql       # ä»»å‹™é™„ä»¶è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: tasks, accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 5: æ—¥èªŒæ¨¡çµ„ (Diary Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00400_enums_diary.sql            # æ—¥èªŒåˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: weather_type, diary_status, work_item_type
â”‚   â”‚
â”‚   â”œâ”€â”€ 00401_diaries.sql                # æ—¥èªŒè¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00402_diary_entries.sql          # æ—¥èªŒå·¥é …è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: diaries, tasks
â”‚   â”‚
â”‚   â”œâ”€â”€ 00403_diary_attachments.sql      # æ—¥èªŒé™„ä»¶è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: diaries, accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 6: å“ç®¡æ¨¡çµ„ (QC Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00500_enums_qc.sql               # å“ç®¡åˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: qc_inspection_status, qc_inspection_type, qc_item_status
â”‚   â”‚
â”‚   â”œâ”€â”€ 00501_qc_inspections.sql         # å“ç®¡æª¢æŸ¥è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, tasks, diaries
â”‚   â”‚
â”‚   â”œâ”€â”€ 00502_qc_inspection_items.sql    # å“ç®¡æª¢æŸ¥é …ç›®è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: qc_inspections
â”‚   â”‚
â”‚   â”œâ”€â”€ 00503_qc_inspection_attachments.sql # å“ç®¡é™„ä»¶è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: qc_inspections, qc_inspection_items
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 7: é©—æ”¶æ¨¡çµ„ (Acceptance Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00600_enums_acceptance.sql       # é©—æ”¶åˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: acceptance_status, acceptance_type, acceptance_decision
â”‚   â”‚
â”‚   â”œâ”€â”€ 00601_acceptances.sql            # é©—æ”¶è¨˜éŒ„è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, tasks, qc_inspections
â”‚   â”‚
â”‚   â”œâ”€â”€ 00602_acceptance_approvals.sql   # é©—æ”¶å¯©æ‰¹è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: acceptances, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00603_acceptance_attachments.sql # é©—æ”¶é™„ä»¶è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: acceptances, accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 8: å•é¡Œç®¡ç†æ¨¡çµ„ (Problem Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00700_enums_problem.sql          # å•é¡Œåˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: problem_type, problem_status, problem_severity, problem_action_type
â”‚   â”‚
â”‚   â”œâ”€â”€ 00701_problems.sql               # å•é¡Œè¨˜éŒ„è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, tasks, qc_inspections, acceptances
â”‚   â”‚
â”‚   â”œâ”€â”€ 00702_problem_actions.sql        # å•é¡Œè™•ç½®è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: problems, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00703_problem_comments.sql       # å•é¡Œè©•è«–è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: problems, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00704_problem_attachments.sql    # å•é¡Œé™„ä»¶è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: problems, accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 9: å¯©è¨ˆèˆ‡æ­·å²æ¨¡çµ„ (Audit & History Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00800_enums_audit.sql            # å¯©è¨ˆåˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: audit_action, audit_severity, audit_entity_type, audit_actor_type
â”‚   â”‚
â”‚   â”œâ”€â”€ 00801_audit_logs.sql             # å¯©è¨ˆæ—¥èªŒè¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, organizations, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00802_search_history.sql         # æœå°‹æ­·å²è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: auth.users
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 10: åŸºç¤è¨­æ–½æ¨¡çµ„ (Infrastructure Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 00900_activity_timeline.sql      # æ™‚é–“è»¸æœå‹™
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, accounts
â”‚   â”‚
â”‚   â”œâ”€â”€ 00901_event_bus.sql              # äº‹ä»¶ç¸½ç·š
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 00902_entity_references.sql      # é—œè¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 00903_metadata_system.sql        # å…ƒæ•¸æ“šç³»çµ±
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 00904_lifecycle_management.sql   # ç”Ÿå‘½é€±æœŸç®¡ç†
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 00905_search_infrastructure.sql  # æœå°‹å¼•æ“åŸºç¤è¨­æ–½
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 00906_files_management.sql       # æª”æ¡ˆç®¡ç†
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 11: é€šçŸ¥æ¨¡çµ„ (Notification Module)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 01000_notifications.sql          # é€šçŸ¥è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: accounts, blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 01001_notification_preferences.sql # é€šçŸ¥åå¥½è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: accounts
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 12: è²¡å‹™æ¨¡çµ„ (Financial Module) - å¯é¸
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 01100_enums_financial.sql        # è²¡å‹™åˆ—èˆ‰é¡å‹
â”‚   â”‚   â””â”€â”€ å…§å®¹: payment_status, invoice_status, contract_status ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 01101_contracts.sql              # åˆç´„è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: blueprints, organizations
â”‚   â”‚
â”‚   â”œâ”€â”€ 01102_payments.sql               # ä»˜æ¬¾è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: contracts, blueprints
â”‚   â”‚
â”‚   â”œâ”€â”€ 01103_invoices.sql               # ç™¼ç¥¨è¡¨
â”‚   â”‚   â””â”€â”€ é—œè¯: contracts, payments
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 13: RLS æ”¿ç­– (Row Level Security)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 02000_rls_helpers.sql            # RLS è¼”åŠ©å‡½æ•¸
â”‚   â”‚   â””â”€â”€ å…§å®¹: is_org_member, is_blueprint_member ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 02001_rls_core.sql               # æ ¸å¿ƒè¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: accounts, organizations, teams RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02002_rls_blueprints.sql         # è—åœ–è¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: blueprints, blueprint_* RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02003_rls_tasks.sql              # ä»»å‹™è¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: tasks, task_* RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02004_rls_diaries.sql            # æ—¥èªŒè¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: diaries, diary_* RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02005_rls_qc.sql                 # å“ç®¡è¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: qc_inspections, qc_* RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02006_rls_acceptance.sql         # é©—æ”¶è¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: acceptances, acceptance_* RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02007_rls_problems.sql           # å•é¡Œè¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: problems, problem_* RLS
â”‚   â”‚
â”‚   â”œâ”€â”€ 02008_rls_audit.sql              # å¯©è¨ˆè¡¨ RLS
â”‚   â”‚   â””â”€â”€ å…§å®¹: audit_logs RLS
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 14: è§¸ç™¼å™¨èˆ‡å‡½æ•¸ (Triggers & Functions)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 03000_triggers_common.sql        # é€šç”¨è§¸ç™¼å™¨
â”‚   â”‚   â””â”€â”€ å…§å®¹: updated_at, soft_delete ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 03001_triggers_auth.sql          # èªè­‰è§¸ç™¼å™¨
â”‚   â”‚   â””â”€â”€ å…§å®¹: auth.users â†’ accounts åŒæ­¥
â”‚   â”‚
â”‚   â”œâ”€â”€ 03002_triggers_audit.sql         # å¯©è¨ˆè§¸ç™¼å™¨
â”‚   â”‚   â””â”€â”€ å…§å®¹: è‡ªå‹•è¨˜éŒ„å¯©è¨ˆæ—¥èªŒ
â”‚   â”‚
â”‚   â”œâ”€â”€ 03003_functions_api.sql          # API å‡½æ•¸
â”‚   â”‚   â””â”€â”€ å…§å®¹: create_organization, create_blueprint ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 03004_functions_search.sql       # æœå°‹å‡½æ•¸
â”‚   â”‚   â””â”€â”€ å…§å®¹: global_search, get_popular_searches ç­‰
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 15: å„²å­˜èˆ‡å³æ™‚ (Storage & Realtime)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 04000_storage_buckets.sql        # å„²å­˜æ¡¶é…ç½®
â”‚   â”‚   â””â”€â”€ å…§å®¹: blueprints, attachments, profiles ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 04001_storage_policies.sql       # å„²å­˜æ”¿ç­–
â”‚   â”‚   â””â”€â”€ å…§å®¹: æª”æ¡ˆå­˜å–æ¬Šé™æ”¿ç­–
â”‚   â”‚
â”‚   â”œâ”€â”€ 04002_realtime_channels.sql      # å³æ™‚é »é“é…ç½®
â”‚   â”‚   â””â”€â”€ å…§å®¹: blueprint_updates, notifications ç­‰
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ PHASE 16: è¦–åœ–èˆ‡ç´¢å¼•å„ªåŒ– (Views & Index Optimization)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 05000_views_permissions.sql      # æ¬Šé™è¦–åœ–
â”‚   â”‚   â””â”€â”€ å…§å®¹: user_permissions, accessible_blueprints ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 05001_views_dashboard.sql        # å„€è¡¨æ¿è¦–åœ–
â”‚   â”‚   â””â”€â”€ å…§å®¹: blueprint_summary, task_statistics ç­‰
â”‚   â”‚
â”‚   â”œâ”€â”€ 05002_indexes_optimization.sql   # ç´¢å¼•å„ªåŒ–
â”‚   â”‚   â””â”€â”€ å…§å®¹: è¤‡åˆç´¢å¼•ã€éƒ¨åˆ†ç´¢å¼•å„ªåŒ–
â”‚   â”‚
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚ EXISTING MIGRATIONS (ç¾æœ‰é·ç§» - å¾…æ•´åˆ)
â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚   â”‚
â”‚   â”œâ”€â”€ 20241203000000_create_search_history.sql  # å·²å­˜åœ¨
â”‚   â”œâ”€â”€ 20241203100000_create_audit_logs.sql      # å·²å­˜åœ¨
â”‚   â”œâ”€â”€ 20241203100001_create_diaries.sql         # å·²å­˜åœ¨
â”‚   â””â”€â”€ 20241203100002_create_qc_acceptance_problem.sql # å·²å­˜åœ¨
â”‚
â”œâ”€â”€ seeds/                               # ç¨®å­æ•¸æ“šç›®éŒ„
â”‚   â”œâ”€â”€ seed.sql                         # ä¸»ç¨®å­æ–‡ä»¶ (åŸºç¤æ¶æ§‹)
â”‚   â”œâ”€â”€ seed_diaries.sql                 # æ—¥èªŒç¨®å­æ•¸æ“š
â”‚   â”œâ”€â”€ seed_qc_inspections.sql          # å“ç®¡ç¨®å­æ•¸æ“š
â”‚   â”œâ”€â”€ seed_acceptances.sql             # é©—æ”¶ç¨®å­æ•¸æ“š
â”‚   â”œâ”€â”€ seed_problems.sql                # å•é¡Œç¨®å­æ•¸æ“š
â”‚   â”œâ”€â”€ seed_audit_logs.sql              # å¯©è¨ˆç¨®å­æ•¸æ“š
â”‚   â””â”€â”€ seed_search_history.sql          # æœå°‹æ­·å²ç¨®å­æ•¸æ“š
â”‚
â”œâ”€â”€ functions/                           # Edge Functions ç›®éŒ„ (æœªä¾†æ“´å±•)
â”‚   â””â”€â”€ README.md
â”‚
â””â”€â”€ types/                               # TypeScript é¡å‹å®šç¾© (è‡ªå‹•ç”Ÿæˆ)
    â””â”€â”€ database.ts
```

---

## é·ç§»å‘½åè¦ç¯„

### å‘½åæ ¼å¼

```
NNNNN_descriptive_name.sql
```

å…¶ä¸­ï¼š
- `NNNNN`: 5 ä½æ•¸é †åºè™Ÿ
- `descriptive_name`: æè¿°æ€§åç¨± (å°å¯«ã€åº•ç·šåˆ†éš”)

### é †åºè™Ÿåˆ†é…

| ç¯„åœ | æ¨¡çµ„ | èªªæ˜ |
|------|------|------|
| 00001-00099 | åŸºç¤è¨­æ–½ | Extensions, Enums, Private Schema |
| 00100-00199 | æ ¸å¿ƒè¡¨ | Accounts, Organizations, Teams |
| 00200-00299 | è—åœ–æ¨¡çµ„ | Blueprints, Members, Roles |
| 00300-00399 | ä»»å‹™æ¨¡çµ„ | Tasks, Assignments, Comments |
| 00400-00499 | æ—¥èªŒæ¨¡çµ„ | Diaries, Entries, Attachments |
| 00500-00599 | å“ç®¡æ¨¡çµ„ | QC Inspections, Items |
| 00600-00699 | é©—æ”¶æ¨¡çµ„ | Acceptances, Approvals |
| 00700-00799 | å•é¡Œæ¨¡çµ„ | Problems, Actions, Comments |
| 00800-00899 | å¯©è¨ˆæ¨¡çµ„ | Audit Logs, Search History |
| 00900-00999 | åŸºç¤è¨­æ–½æ¨¡çµ„ | Timeline, Events, Metadata |
| 01000-01099 | é€šçŸ¥æ¨¡çµ„ | Notifications, Preferences |
| 01100-01199 | è²¡å‹™æ¨¡çµ„ | Contracts, Payments |
| 02000-02099 | RLS æ”¿ç­– | Row Level Security Policies |
| 03000-03099 | è§¸ç™¼å™¨èˆ‡å‡½æ•¸ | Triggers, Functions |
| 04000-04099 | å„²å­˜èˆ‡å³æ™‚ | Storage, Realtime |
| 05000-05099 | è¦–åœ–èˆ‡å„ªåŒ– | Views, Index Optimization |
| 20XXXXXX... | æ™‚é–“æˆ³é·ç§» | æ—¥æœŸæ™‚é–“æˆ³é·ç§» (ç¾æœ‰) |

---

## åŸ·è¡Œé †åº

### å®Œæ•´éƒ¨ç½²é †åº

```bash
# 1. åŸºç¤è¨­æ–½
supabase migration up --include 00001_extensions.sql
supabase migration up --include 00002_enums_core.sql
supabase migration up --include 00003_schema_private.sql

# 2. æ ¸å¿ƒè¡¨
supabase migration up --include 00100_accounts.sql
supabase migration up --include 00101_organizations.sql
# ... ä¾åºåŸ·è¡Œ

# 3. ç¨®å­æ•¸æ“š (é–‹ç™¼ç’°å¢ƒ)
supabase db seed --file seeds/seed.sql
supabase db seed --file seeds/seed_diaries.sql
# ... ä¾åºåŸ·è¡Œ
```

### ç¨®å­æ•¸æ“šåŸ·è¡Œé †åº

```
1. seed.sql              # åŸºç¤æ¶æ§‹ (å¿…é ˆå…ˆåŸ·è¡Œ)
2. seed_diaries.sql      # ä¾è³´: seed.sql
3. seed_qc_inspections.sql # ä¾è³´: seed.sql, seed_diaries.sql
4. seed_acceptances.sql  # ä¾è³´: seed.sql, seed_qc_inspections.sql
5. seed_problems.sql     # ä¾è³´: seed.sql, seed_qc_inspections.sql, seed_acceptances.sql
6. seed_audit_logs.sql   # ä¾è³´: seed.sql
7. seed_search_history.sql # ä¾è³´: seed.sql (å¯ç¨ç«‹åŸ·è¡Œ)
```

---

## æ¨¡çµ„åˆ†é¡

### æ ¸å¿ƒæ¨¡çµ„ (Core)

| æ¨¡çµ„ | è¡¨ | èªªæ˜ |
|------|-----|------|
| å¸³è™Ÿ | accounts | ç”¨æˆ¶å¸³è™Ÿè³‡æ–™ |
| çµ„ç¹” | organizations, organization_members | çµ„ç¹”èˆ‡æˆå“¡ç®¡ç† |
| åœ˜éšŠ | teams, team_members | åœ˜éšŠèˆ‡æˆå“¡ç®¡ç† |
| è—åœ– | blueprints, blueprint_members, blueprint_teams | å·¥ä½œå€èˆ‡æ¬Šé™ |

### æ¥­å‹™æ¨¡çµ„ (Business)

| æ¨¡çµ„ | è¡¨ | èªªæ˜ |
|------|-----|------|
| ä»»å‹™ | tasks, task_assignments, task_comments, task_attachments | ä»»å‹™ç®¡ç† |
| æ—¥èªŒ | diaries, diary_entries, diary_attachments | æ–½å·¥æ—¥èªŒ |
| å“ç®¡ | qc_inspections, qc_inspection_items, qc_inspection_attachments | å“è³ªç®¡æ§ |
| é©—æ”¶ | acceptances, acceptance_approvals, acceptance_attachments | é©—æ”¶æµç¨‹ |
| å•é¡Œ | problems, problem_actions, problem_comments, problem_attachments | å•é¡Œè¿½è¹¤ |

### æ”¯æ´æ¨¡çµ„ (Support)

| æ¨¡çµ„ | è¡¨ | èªªæ˜ |
|------|-----|------|
| å¯©è¨ˆ | audit_logs | å¯©è¨ˆæ—¥èªŒ |
| æœå°‹ | search_history | æœå°‹æ­·å² |
| é€šçŸ¥ | notifications, notification_preferences | é€šçŸ¥ç³»çµ± |
| æª”æ¡ˆ | files | æª”æ¡ˆç®¡ç† |

### æ“´å±•æ¨¡çµ„ (Extension)

| æ¨¡çµ„ | è¡¨ | èªªæ˜ |
|------|-----|------|
| è²¡å‹™ | contracts, payments, invoices | è²¡å‹™ç®¡ç† |

---

## Seeds çµæ§‹

### seed.sql (ä¸»ç¨®å­æ–‡ä»¶)

åŒ…å«ï¼š
- æ ¸å¿ƒ ENUM é¡å‹
- æ ¸å¿ƒè¡¨çµæ§‹
- RLS è¼”åŠ©å‡½æ•¸
- é€šç”¨è§¸ç™¼å™¨
- åŸºç¤ RLS æ”¿ç­–
- èªè­‰æ•´åˆ
- API å‡½æ•¸
- å®¹å™¨å±¤åŸºç¤è¨­æ–½
- å„²å­˜é…ç½®
- å³æ™‚é…ç½®

### æ¨¡çµ„ç¨®å­æ–‡ä»¶

æ¯å€‹æ¨¡çµ„ç¨®å­æ–‡ä»¶åŒ…å«ï¼š
- æ¨¡çµ„å°ˆç”¨ ENUM é¡å‹
- æ¨¡çµ„è¡¨çµæ§‹
- æ¨¡çµ„ç´¢å¼•
- æ¨¡çµ„ RLS æ”¿ç­–
- æ¨¡çµ„è§¸ç™¼å™¨
- æ¨¡çµ„å‡½æ•¸
- æ¨¡çµ„è¨»è§£

---

## é–‹ç™¼æŒ‡å—

### æ–°å¢é·ç§»

```bash
# 1. å‰µå»ºæ–°é·ç§»
supabase migration new add_feature_name

# 2. ç·¨è¼¯é·ç§»æ–‡ä»¶
# éµå¾ªå‘½åè¦ç¯„å’Œçµæ§‹

# 3. æ¸¬è©¦é·ç§»
supabase db reset

# 4. é©—è­‰
supabase db lint
```

### æœ€ä½³å¯¦è¸

1. **å†ªç­‰æ€§**: ä½¿ç”¨ `IF NOT EXISTS`ã€`CREATE OR REPLACE`
2. **å¯å›æ»¾**: æ¯å€‹é·ç§»æ‡‰å¯å®‰å…¨å›æ»¾
3. **åŸå­æ€§**: æ¯å€‹é·ç§»æ‡‰è©²æ˜¯å®Œæ•´çš„é‚è¼¯å–®å…ƒ
4. **è¨»è§£**: æ·»åŠ æ¸…æ™°çš„æ–‡ä»¶è¨»è§£
5. **æ¸¬è©¦**: é·ç§»å‰å¾Œé€²è¡Œå®Œæ•´æ¸¬è©¦

### é·ç§»æ¨¡æ¿

```sql
-- Migration: [æè¿°]
-- Description: [è©³ç´°èªªæ˜]
-- Prerequisites: [ä¾è³´é·ç§»]
-- Created: [æ—¥æœŸ]

-- ============================================================================
-- 1. Enums (å¦‚éœ€è¦)
-- ============================================================================

-- ============================================================================
-- 2. Tables
-- ============================================================================

-- ============================================================================
-- 3. Indexes
-- ============================================================================

-- ============================================================================
-- 4. RLS Policies
-- ============================================================================

-- ============================================================================
-- 5. Triggers
-- ============================================================================

-- ============================================================================
-- 6. Functions
-- ============================================================================

-- ============================================================================
-- 7. Comments
-- ============================================================================
```

---

## ç›¸é—œæ–‡ä»¶

- [MIGRATION_GUIDE.md](./MIGRATION_GUIDE.md) - é·ç§»æ“ä½œæŒ‡å—
- [config.toml](./config.toml) - Supabase é…ç½®
- [seeds/README.md](./seeds/README.md) - ç¨®å­æ•¸æ“šèªªæ˜

---

*æœ€å¾Œæ›´æ–°: 2024-12-03*
